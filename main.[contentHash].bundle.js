/*! For license information please see main.[contentHash].bundle.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{FirebaseError:()=>m,SDK_VERSION:()=>ye,_DEFAULT_ENTRY_NAME:()=>se,_addComponent:()=>ue,_addOrOverwriteComponent:()=>le,_apps:()=>ae,_clearComponents:()=>pe,_components:()=>ce,_getProvider:()=>de,_registerComponent:()=>he,_removeServiceInstance:()=>fe,deleteApp:()=>be,getApp:()=>we,getApps:()=>Ie,initializeApp:()=>ve,onLog:()=>Te,registerVersion:()=>_e,setLogLevel:()=>Ee});const n=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=r>>2,l=(3&r)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),i.push(n[u],n[l],n[h],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw Error();const c=r<<2|s>>4;if(i.push(c),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},r=function(e){return function(e){const t=n(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},s=function(e){try{return i.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function o(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=o(e[n],t[n]));return e}class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function u(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())}function l(){try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function h(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function d(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function f(){const e=c();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function p(){return"object"==typeof indexedDB}class m extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,g.prototype.create)}}class g{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(y,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new m(i,o,n)}}const y=/\{\$([^}]+)}/g;function v(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function w(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(I(n)&&I(s)){if(!w(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function I(e){return null!==e&&"object"==typeof e}function b(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function _(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function T(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function E(e,t){const n=new k(e,t);return n.subscribe.bind(n)}class k{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=S),void 0===i.error&&(i.error=S),void 0===i.complete&&(i.complete=S);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function S(){}function A(e){return e&&e._delegate?e._delegate:e}class C{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const N="[DEFAULT]";class R{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new a;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:N})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===N?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:N:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class D{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new R(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const O=[];var P;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(P||(P={}));const L={debug:P.DEBUG,verbose:P.VERBOSE,info:P.INFO,warn:P.WARN,error:P.ERROR,silent:P.SILENT},M=P.INFO,x={[P.DEBUG]:"log",[P.VERBOSE]:"log",[P.INFO]:"info",[P.WARN]:"warn",[P.ERROR]:"error"},U=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=x[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class F{constructor(e){this.name=e,this._logLevel=M,this._logHandler=U,this._userLogHandler=null,O.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in P))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?L[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,P.DEBUG,...e),this._logHandler(this,P.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,P.VERBOSE,...e),this._logHandler(this,P.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,P.INFO,...e),this._logHandler(this,P.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,P.WARN,...e),this._logHandler(this,P.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,P.ERROR,...e),this._logHandler(this,P.ERROR,...e)}}let V,j;const B=new WeakMap,q=new WeakMap,z=new WeakMap,H=new WeakMap,$=new WeakMap;let K={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return q.get(e);if("objectStoreNames"===t)return e.objectStoreNames||z.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Q(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function G(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(j||(j=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(X(this),t),Q(B.get(this))}:function(...t){return Q(e.apply(X(this),t))}:function(t,...n){const i=e.call(X(this),t,...n);return z.set(i,t.sort?t.sort():[t]),Q(i)}}function W(e){return"function"==typeof e?G(e):(e instanceof IDBTransaction&&function(e){if(q.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));q.set(e,t)}(e),t=e,(V||(V=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,K):e);var t}function Q(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(Q(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&B.set(t,e)})).catch((()=>{})),$.set(t,e),t}(e);if(H.has(e))return H.get(e);const t=W(e);return t!==e&&(H.set(e,t),$.set(t,e)),t}const X=e=>$.get(e);const Y=["get","getKey","getAll","getAllKeys","count"],J=["put","add","delete","clear"],Z=new Map;function ee(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Z.get(t))return Z.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=J.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Y.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return Z.set(t,s),s}K=(e=>({...e,get:(t,n,i)=>ee(t,n)||e.get(t,n,i),has:(t,n)=>!!ee(t,n)||e.has(t,n)}))(K);class te{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ne="@firebase/app",ie="0.7.27",re=new F("@firebase/app"),se="[DEFAULT]",oe={[ne]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ae=new Map,ce=new Map;function ue(e,t){try{e.container.addComponent(t)}catch(n){re.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function le(e,t){e.container.addOrOverwriteComponent(t)}function he(e){const t=e.name;if(ce.has(t))return re.debug(`There were multiple attempts to register component ${t}.`),!1;ce.set(t,e);for(const t of ae.values())ue(t,e);return!0}function de(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function fe(e,t,n=se){de(e,t).clearInstance(n)}function pe(){ce.clear()}const me=new g("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class ge{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new C("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw me.create("app-deleted",{appName:this._name})}}const ye="9.8.4";function ve(e,t={}){if("object"!=typeof t){t={name:t}}const n=Object.assign({name:se,automaticDataCollectionEnabled:!1},t),i=n.name;if("string"!=typeof i||!i)throw me.create("bad-app-name",{appName:String(i)});const r=ae.get(i);if(r){if(w(e,r.options)&&w(n,r.config))return r;throw me.create("duplicate-app",{appName:i})}const s=new D(i);for(const e of ce.values())s.addComponent(e);const o=new ge(e,n,s);return ae.set(i,o),o}function we(e=se){const t=ae.get(e);if(!t)throw me.create("no-app",{appName:e});return t}function Ie(){return Array.from(ae.values())}async function be(e){const t=e.name;ae.has(t)&&(ae.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function _e(e,t,n){var i;let r=null!==(i=oe[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void re.warn(e.join(" "))}he(new C(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}function Te(e,t){if(null!==e&&"function"!=typeof e)throw me.create("invalid-log-argument");!function(e,t){for(const n of O){let i=null;t&&t.level&&(i=L[t.level]),n.userLogHandler=null===e?null:(t,n,...r)=>{const s=r.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=i?i:t.logLevel)&&e({level:P[n].toLowerCase(),message:s,args:r,type:t.name})}}}(e,t)}function Ee(e){var t;t=e,O.forEach((e=>{e.setLogLevel(t)}))}const ke="firebase-heartbeat-store";let Se=null;function Ae(){return Se||(Se=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=Q(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(Q(o.result),e.oldVersion,e.newVersion,Q(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(ke)}}).catch((e=>{throw me.create("storage-open",{originalErrorMessage:e.message})}))),Se}async function Ce(e,t){var n;try{const n=(await Ae()).transaction(ke,"readwrite"),i=n.objectStore(ke);return await i.put(t,Ne(e)),n.done}catch(e){throw me.create("storage-set",{originalErrorMessage:null===(n=e)||void 0===n?void 0:n.message})}}function Ne(e){return`${e.name}!${e.options.appId}`}class Re{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Oe(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=De();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=De(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),Pe(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Pe(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=r(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function De(){return(new Date).toISOString().substring(0,10)}class Oe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!p()&&new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){var t;try{return(await Ae()).transaction(ke).objectStore(ke).get(Ne(e))}catch(e){throw me.create("storage-get",{originalErrorMessage:null===(t=e)||void 0===t?void 0:t.message})}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ce(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ce(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Pe(e){return r(JSON.stringify({version:2,heartbeats:e})).length}var Le;Le="",he(new C("platform-logger",(e=>new te(e)),"PRIVATE")),he(new C("heartbeat",(e=>new Re(e)),"PRIVATE")),_e(ne,ie,Le),_e(ne,ie,"esm2017"),_e("fire-js","");class Me{constructor(e,t){this._delegate=e,this.firebase=t,ue(e,new C("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),be(this._delegate))))}_getService(e,t=se){var n;this._delegate.checkDestroyed();const i=this._delegate.container.getProvider(e);return i.isInitialized()||"EXPLICIT"!==(null===(n=i.getComponent())||void 0===n?void 0:n.instantiationMode)||i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=se){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){ue(this._delegate,e)}_addOrOverwriteComponent(e){le(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const xe=new g("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});const Ue=function e(){const n=function(e){const n={},i={__esModule:!0,initializeApp:function(t,r={}){const s=ve(t,r);if(v(n,s.name))return n[s.name];const o=new e(s,i);return n[s.name]=o,o},app:r,registerVersion:_e,setLogLevel:Ee,onLog:Te,apps:null,SDK_VERSION:ye,INTERNAL:{registerComponent:function(t){const n=t.name,s=n.replace("-compat","");if(he(t)&&"PUBLIC"===t.type){const a=(e=r())=>{if("function"!=typeof e[s])throw xe.create("invalid-app-argument",{appName:n});return e[s]()};void 0!==t.serviceProps&&o(a,t.serviceProps),i[s]=a,e.prototype[s]=function(...e){return this._getService.bind(this,n).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?i[s]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:t}};function r(e){if(!v(n,e=e||se))throw xe.create("no-app",{appName:e});return n[e]}return i.default=i,Object.defineProperty(i,"apps",{get:function(){return Object.keys(n).map((e=>n[e]))}}),r.App=e,i}(Me);return n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){o(n,e)},createSubscribe:E,ErrorFactory:g,deepExtend:o}),n}(),Fe=new F("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Fe.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&Fe.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Ve=Ue;!function(e){_e("@firebase/app-compat","0.1.28",e)}();function je(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Object.create;Object.create;const Be="facebook.com",qe="github.com",ze="google.com",He="password",$e="twitter.com",Ke="EMAIL_SIGNIN",Ge="PASSWORD_RESET",We="RECOVER_EMAIL",Qe="REVERT_SECOND_FACTOR_ADDITION",Xe="VERIFY_AND_CHANGE_EMAIL",Ye="VERIFY_EMAIL";function Je(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Ze=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},et=Je,tt=new g("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),nt=new F("@firebase/auth");function it(e,...t){nt.logLevel<=P.ERROR&&nt.error(`Auth (${ye}): ${e}`,...t)}function rt(e,...t){throw ct(e,...t)}function st(e,...t){return ct(e,...t)}function ot(e,t,n){const i=Object.assign(Object.assign({},et()),{[t]:n});return new g("auth","Firebase",i).create(t,{appName:e.name})}function at(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&rt(e,"argument-error"),ot(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ct(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return tt.create(e,...t)}function ut(e,t,...n){if(!e)throw ct(t,...n)}function lt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw it(t),new Error(t)}function ht(e,t){e||lt(t)}const dt=new Map;function ft(e){ht(e instanceof Function,"Expected a class definition");let t=dt.get(e);return t?(ht(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,dt.set(e,t),t)}function pt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function mt(){return"http:"===gt()||"https:"===gt()}function gt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class yt{constructor(e,t){this.shortDelay=e,this.longDelay=t,ht(t>e,"Short delay should be less than long delay!"),this.isMobile=u()||d()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(mt()||h()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function vt(e,t){ht(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class wt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void lt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void lt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void lt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const It={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},bt=new yt(3e4,6e4);function _t(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Tt(e,t,n,i,r={}){return Et(e,r,(async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});const o=b(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),wt.fetch()(St(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},r))}))}async function Et(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},It),t);try{const t=new At(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw Ct(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ct(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw Ct(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw Ct(e,"user-disabled",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw ot(e,a,o);rt(e,a)}}catch(t){if(t instanceof m)throw t;rt(e,"network-request-failed")}}async function kt(e,t,n,i,r={}){const s=await Tt(e,t,n,i,r);return"mfaPendingCredential"in s&&rt(e,"multi-factor-auth-required",{_serverResponse:s}),s}function St(e,t,n,i){const r=`${t}${n}?${i}`;return e.config.emulator?vt(e.config,r):`${e.config.apiScheme}://${r}`}class At{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(st(this.auth,"network-request-failed"))),bt.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ct(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=st(e,t,i);return r.customData._tokenResponse=n,r}function Nt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Rt(e){return 1e3*Number(e)}function Dt(e){var t;const[n,i,r]=e.split(".");if(void 0===n||void 0===i||void 0===r)return it("JWT malformed, contained fewer than 3 sections"),null;try{const e=s(i);return e?JSON.parse(e):(it("Failed to decode base64 JWT payload"),null)}catch(e){return it("Caught error parsing JWT payload as JSON",null===(t=e)||void 0===t?void 0:t.toString()),null}}async function Ot(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof m&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Pt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){var e;try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null===(e=t)||void 0===e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Lt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Nt(this.lastLoginAt),this.creationTime=Nt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Mt(e){var t;const n=e.auth,i=await e.getIdToken(),r=await Ot(e,async function(e,t){return Tt(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));ut(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=je(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Lt(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class xt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ut(e.idToken,"internal-error"),ut(void 0!==e.idToken,"internal-error"),ut(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Dt(e);return ut(t,"internal-error"),ut(void 0!==t.exp,"internal-error"),ut(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return ut(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await Et(e,{},(async()=>{const n=b({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=St(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",wt.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new xt;return n&&(ut("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(ut("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(ut("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xt,this.toJSON())}_performRefresh(){return lt("not implemented")}}function Ut(e,t){ut("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ft{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=je(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Pt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Lt(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Ot(this,this.stsTokenManager.getToken(this.auth,e));return ut(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=A(e),i=await n.getIdToken(t),r=Dt(i);ut(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:Nt(Rt(r.auth_time)),issuedAtTime:Nt(Rt(r.iat)),expirationTime:Nt(Rt(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=A(e);await Mt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(ut(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Ft(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){ut(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Mt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Ot(this,async function(e,t){return Tt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:b,stsTokenManager:_}=t;ut(v&&_,e,"internal-error");const T=xt.fromJSON(this.name,_);ut("string"==typeof v,e,"internal-error"),Ut(l,e.name),Ut(h,e.name),ut("boolean"==typeof w,e,"internal-error"),ut("boolean"==typeof I,e,"internal-error"),Ut(d,e.name),Ut(f,e.name),Ut(p,e.name),Ut(m,e.name),Ut(g,e.name),Ut(y,e.name);const E=new Ft({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const i=new xt;i.updateFromServerResponse(t);const r=new Ft({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Mt(r),r}}class Vt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Vt.type="NONE";const jt=Vt;function Bt(e,t,n){return`firebase:${e}:${t}:${n}`}class qt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=Bt(this.userKey,i.apiKey,r),this.fullPersistenceKey=Bt("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ft._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new qt(ft(jt),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=i[0]||ft(jt);const s=Bt(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const i=Ft._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new qt(r,e,n)):new qt(r,e,n)}}function zt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Gt(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ht(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Qt(t))return"Blackberry";if(Xt(t))return"Webos";if($t(t))return"Safari";if((t.includes("chrome/")||Kt(t))&&!t.includes("edge/"))return"Chrome";if(Wt(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Ht(e=c()){return/firefox\//i.test(e)}function $t(e=c()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Kt(e=c()){return/crios\//i.test(e)}function Gt(e=c()){return/iemobile/i.test(e)}function Wt(e=c()){return/android/i.test(e)}function Qt(e=c()){return/blackberry/i.test(e)}function Xt(e=c()){return/webos/i.test(e)}function Yt(e=c()){return/iphone|ipad|ipod/i.test(e)}function Jt(e=c()){return Yt(e)||Wt(e)||Xt(e)||Qt(e)||/windows phone/i.test(e)||Gt(e)}function Zt(e,t=[]){let n;switch(e){case"Browser":n=zt(c());break;case"Worker":n=`${zt(c())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${ye}/${i}`}class en{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){var t;if(this.auth.currentUser===e)return;const n=[];try{for(const t of this.queue)await t(e),t.onAbort&&n.push(t.onAbort)}catch(e){n.reverse();for(const e of n)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===(t=e)||void 0===t?void 0:t.message})}}}class tn{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new rn(this),this.idTokenSubscription=new rn(this),this.beforeStateQueue=new en(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tt,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ft(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await qt.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ut(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){var t;try{await Mt(e)}catch(e){if("auth/network-request-failed"!==(null===(t=e)||void 0===t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?A(e):null;return t&&ut(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ut(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(ft(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new g("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ft(e)||this._popupRedirectResolver;ut(t,this,"argument-error"),this.redirectPersistenceManager=await qt.create(this,[ft(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return ut(s,this,"internal-error"),s.then((()=>r(this.currentUser))),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ut(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Zt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function nn(e){return A(e)}class rn{constructor(e){this.auth=e,this.observer=null,this.addObserver=E((e=>this.observer=e))}get next(){return ut(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function sn(e,t,n){const i=nn(e);ut(i._canInitEmulator,i,"emulator-config-failed"),ut(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=on(t),{host:o,port:a}=function(e){const t=on(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:an(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:an(t)}}}(t),c=null===a?"":`:${a}`;i.config.emulator={url:`${s}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function on(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function an(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class cn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return lt("not implemented")}_getIdTokenResponse(e){return lt("not implemented")}_linkToIdToken(e,t){return lt("not implemented")}_getReauthenticationResolver(e){return lt("not implemented")}}async function un(e,t){return Tt(e,"POST","/v1/accounts:resetPassword",_t(e,t))}async function ln(e,t){return Tt(e,"POST","/v1/accounts:update",t)}async function hn(e,t){return Tt(e,"POST","/v1/accounts:sendOobCode",_t(e,t))}class dn extends cn{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new dn(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new dn(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return kt(e,"POST","/v1/accounts:signInWithPassword",_t(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return kt(e,"POST","/v1/accounts:signInWithEmailLink",_t(e,t))}(e,{email:this._email,oobCode:this._password});default:rt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ln(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return kt(e,"POST","/v1/accounts:signInWithEmailLink",_t(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:rt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function fn(e,t){return kt(e,"POST","/v1/accounts:signInWithIdp",_t(e,t))}class pn extends cn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new pn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):rt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=je(t,["providerId","signInMethod"]);if(!n||!i)return null;const s=new pn(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return fn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,fn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=b(t)}return e}}const mn={USER_NOT_FOUND:"user-not-found"};class gn extends cn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new gn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new gn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return kt(e,"POST","/v1/accounts:signInWithPhoneNumber",_t(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await kt(e,"POST","/v1/accounts:signInWithPhoneNumber",_t(e,t));if(n.temporaryProof)throw Ct(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return kt(e,"POST","/v1/accounts:signInWithPhoneNumber",_t(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),mn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new gn({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class yn{constructor(e){var t,n,i,r,s,o;const a=_(T(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);ut(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(r=a.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=_(T(e)).link,n=t?_(T(t)).deep_link_id:null,i=_(T(e)).deep_link_id;return(i?_(T(i)).link:null)||i||n||t||e}(e);try{return new yn(t)}catch(e){return null}}}class vn{constructor(){this.providerId=vn.PROVIDER_ID}static credential(e,t){return dn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=yn.parseLink(t);return ut(n,"argument-error"),dn._fromEmailAndCode(e,n.code,n.tenantId)}}vn.PROVIDER_ID="password",vn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",vn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class wn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class In extends wn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class bn extends In{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return ut("providerId"in t&&"signInMethod"in t,"argument-error"),pn._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ut(e.idToken||e.accessToken,"argument-error"),pn._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return bn.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return bn.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:i,pendingToken:r,nonce:s,providerId:o}=e;if(!(n||i||t||r))return null;if(!o)return null;try{return new bn(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:r})}catch(e){return null}}}class _n extends In{constructor(){super("facebook.com")}static credential(e){return pn._fromParams({providerId:_n.PROVIDER_ID,signInMethod:_n.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _n.credentialFromTaggedObject(e)}static credentialFromError(e){return _n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return _n.credential(e.oauthAccessToken)}catch(e){return null}}}_n.FACEBOOK_SIGN_IN_METHOD="facebook.com",_n.PROVIDER_ID="facebook.com";class Tn extends In{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return pn._fromParams({providerId:Tn.PROVIDER_ID,signInMethod:Tn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Tn.credentialFromTaggedObject(e)}static credentialFromError(e){return Tn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Tn.credential(t,n)}catch(e){return null}}}Tn.GOOGLE_SIGN_IN_METHOD="google.com",Tn.PROVIDER_ID="google.com";class En extends In{constructor(){super("github.com")}static credential(e){return pn._fromParams({providerId:En.PROVIDER_ID,signInMethod:En.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return En.credentialFromTaggedObject(e)}static credentialFromError(e){return En.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return En.credential(e.oauthAccessToken)}catch(e){return null}}}En.GITHUB_SIGN_IN_METHOD="github.com",En.PROVIDER_ID="github.com";class kn extends cn{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return fn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,fn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fn(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i,pendingToken:r}=t;return n&&i&&r&&n===i?new kn(n,r):null}static _create(e,t){return new kn(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Sn extends wn{constructor(e){ut(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Sn.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Sn.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=kn.fromJSON(e);return ut(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return kn._create(n,t)}catch(e){return null}}}class An extends In{constructor(){super("twitter.com")}static credential(e,t){return pn._fromParams({providerId:An.PROVIDER_ID,signInMethod:An.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return An.credentialFromTaggedObject(e)}static credentialFromError(e){return An.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return An.credential(t,n)}catch(e){return null}}}async function Cn(e,t){return kt(e,"POST","/v1/accounts:signUp",_t(e,t))}An.TWITTER_SIGN_IN_METHOD="twitter.com",An.PROVIDER_ID="twitter.com";class Nn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await Ft._fromIdTokenResponse(e,n,i),s=Rn(n);return new Nn({user:r,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=Rn(n);return new Nn({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function Rn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Dn extends m{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Dn.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Dn(e,t,n,i)}}function On(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Dn._fromErrorAndOperation(e,n,t,i);throw n}))}function Pn(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function Ln(e,t){const n=A(e);await xn(!0,n,t);const{providerUserInfo:i}=await async function(e,t){return Tt(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),r=Pn(i||[]);return n.providerData=n.providerData.filter((e=>r.has(e.providerId))),r.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function Mn(e,t,n=!1){const i=await Ot(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Nn._forOperation(e,"link",i)}async function xn(e,t,n){await Mt(t);const i=!1===e?"provider-already-linked":"no-such-provider";ut(Pn(t.providerData).has(n)===e,t.auth,i)}async function Un(e,t,n=!1){var i;const{auth:r}=e,s="reauthenticate";try{const i=await Ot(e,On(r,s,t,e),n);ut(i.idToken,r,"internal-error");const o=Dt(i.idToken);ut(o,r,"internal-error");const{sub:a}=o;return ut(e.uid===a,r,"user-mismatch"),Nn._forOperation(e,s,i)}catch(e){throw"auth/user-not-found"===(null===(i=e)||void 0===i?void 0:i.code)&&rt(r,"user-mismatch"),e}}async function Fn(e,t,n=!1){const i="signIn",r=await On(e,i,t),s=await Nn._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}async function Vn(e,t){return Fn(nn(e),t)}async function jn(e,t){const n=A(e);return await xn(!1,n,t.providerId),Mn(n,t)}async function Bn(e,t){return Un(A(e),t)}async function qn(e,t){const n=nn(e),i=await async function(e,t){return kt(e,"POST","/v1/accounts:signInWithCustomToken",_t(e,t))}(n,{token:t,returnSecureToken:!0}),r=await Nn._fromIdTokenResponse(n,"signIn",i);return await n._updateCurrentUser(r.user),r}class zn{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Hn._fromServerResponse(e,t):rt(e,"internal-error")}}class Hn extends zn{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Hn(t)}}function $n(e,t,n){var i;ut((null===(i=n.url)||void 0===i?void 0:i.length)>0,e,"invalid-continue-uri"),ut(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(ut(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(ut(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Kn(e,t,n){const i=A(e),r={requestType:"PASSWORD_RESET",email:t};n&&$n(i,r,n),await async function(e,t){return hn(e,t)}(i,r)}async function Gn(e,t){await async function(e,t){return Tt(e,"POST","/v1/accounts:update",_t(e,t))}(A(e),{oobCode:t})}async function Wn(e,t){const n=A(e),i=await un(n,{oobCode:t}),r=i.requestType;switch(ut(r,n,"internal-error"),r){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ut(i.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ut(i.mfaInfo,n,"internal-error");default:ut(i.email,n,"internal-error")}let s=null;return i.mfaInfo&&(s=zn._fromServerResponse(nn(n),i.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.newEmail:i.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.email:i.newEmail)||null,multiFactorInfo:s},operation:r}}async function Qn(e,t,n){const i=A(e),r={requestType:"EMAIL_SIGNIN",email:t};ut(n.handleCodeInApp,i,"argument-error"),n&&$n(i,r,n),await async function(e,t){return hn(e,t)}(i,r)}async function Xn(e,t){const n={identifier:t,continueUri:mt()?pt():"http://localhost"},{signinMethods:i}=await async function(e,t){return Tt(e,"POST","/v1/accounts:createAuthUri",_t(e,t))}(A(e),n);return i||[]}async function Yn(e,t){const n=A(e),i={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&$n(n.auth,i,t);const{email:r}=await async function(e,t){return hn(e,t)}(n.auth,i);r!==e.email&&await e.reload()}async function Jn(e,t,n){const i=A(e),r={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&$n(i.auth,r,n);const{email:s}=await async function(e,t){return hn(e,t)}(i.auth,r);s!==e.email&&await e.reload()}async function Zn(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const i=A(e),r={idToken:await i.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await Ot(i,async function(e,t){return Tt(e,"POST","/v1/accounts:update",t)}(i.auth,r));i.displayName=s.displayName||null,i.photoURL=s.photoUrl||null;const o=i.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=i.displayName,o.photoURL=i.photoURL),await i._updateTokensIfNecessary(s)}async function ei(e,t,n){const{auth:i}=e,r={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(r.email=t),n&&(r.password=n);const s=await Ot(e,ln(i,r));await e._updateTokensIfNecessary(s,!0)}class ti{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class ni extends ti{constructor(e,t,n,i){super(e,t,n),this.username=i}}class ii extends ti{constructor(e,t){super(e,"facebook.com",t)}}class ri extends ni{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class si extends ti{constructor(e,t){super(e,"google.com",t)}}class oi extends ni{constructor(e,t,n){super(e,"twitter.com",t,n)}}function ai(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:i}=e,r=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!i&&(null==e?void 0:e.idToken)){const i=null===(n=null===(t=Dt(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(i)return new ti(s,"anonymous"!==i&&"custom"!==i?i:null)}if(!i)return null;switch(i){case"facebook.com":return new ii(s,r);case"github.com":return new ri(s,r);case"google.com":return new si(s,r);case"twitter.com":return new oi(s,r,e.screenName||null);case"custom":case"anonymous":return new ti(s,null);default:return new ti(s,i,r)}}(n)}class ci{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new ci("enroll",e)}static _fromMfaPendingCredential(e){return new ci("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return ci._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return ci._fromIdtoken(e.multiFactorSession.idToken)}return null}}class ui{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=nn(e),i=t.customData._serverResponse,r=(i.mfaInfo||[]).map((e=>zn._fromServerResponse(n,e)));ut(i.mfaPendingCredential,n,"internal-error");const s=ci._fromMfaPendingCredential(i.mfaPendingCredential);return new ui(s,r,(async e=>{const r=await e._process(n,s);delete i.mfaInfo,delete i.mfaPendingCredential;const o=Object.assign(Object.assign({},i),{idToken:r.idToken,refreshToken:r.refreshToken});switch(t.operationType){case"signIn":const e=await Nn._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return ut(t.user,n,"internal-error"),Nn._forOperation(t.user,t.operationType,o);default:rt(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class li{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>zn._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new li(e)}async getSession(){return ci._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e,i=await this.getSession(),r=await Ot(this.user,n._process(this.user.auth,i,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){var t;const n="string"==typeof e?e:e.uid,i=await this.user.getIdToken(),r=await Ot(this.user,function(e,t){return Tt(e,"POST","/v2/accounts/mfaEnrollment:withdraw",_t(e,t))}(this.user.auth,{idToken:i,mfaEnrollmentId:n}));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==n)),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==(null===(t=e)||void 0===t?void 0:t.code))throw e}}}const hi=new WeakMap;const di="__sak";class fi{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(di,"1"),this.storage.removeItem(di),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class pi extends fi{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=c();return $t(e)||Yt(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Jt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);f()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}pi.type="LOCAL";const mi=pi;class gi extends fi{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}gi.type="SESSION";const yi=gi;class vi{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new vi(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async e=>e(t.origin,r))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function wi(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}vi.receivers=[];class Ii{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const c=wi("",20);i.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(u),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function bi(){return window}function _i(){return void 0!==bi().WorkerGlobalScope&&"function"==typeof bi().importScripts}const Ti="firebaseLocalStorageDb",Ei="firebaseLocalStorage",ki="fbase_key";class Si{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Ai(e,t){return e.transaction([Ei],t?"readwrite":"readonly").objectStore(Ei)}function Ci(){const e=indexedDB.open(Ti,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Ei,{keyPath:ki})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Ei)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Ti);return new Si(e).toPromise()}(),t(await Ci()))}))}))}async function Ni(e,t,n){const i=Ai(e,!0).put({[ki]:t,value:n});return new Si(i).toPromise()}function Ri(e,t){const n=Ai(e,!0).delete(t);return new Si(n).toPromise()}class Di{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Ci()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _i()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=vi._getInstance(_i()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Ii(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ci();return await Ni(e,di,"1"),await Ri(e,di),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Ni(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Ai(e,!1).get(t),i=await new Si(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Ri(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Ai(e,!1).getAll();return new Si(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Di.type="LOCAL";const Oi=Di;function Pi(e){return new Promise(((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=st("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(i)}))}function Li(e){return`__${e}${Math.floor(1e6*Math.random())}`}const Mi=1e12;class xi{constructor(e){this.auth=e,this.counter=Mi,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Ui(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Mi;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Mi;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Mi;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Ui{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i="string"==typeof e?document.getElementById(e):e;ut(i,"argument-error",{appName:t}),this.container=i,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<e;i++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Fi=Li("rcb"),Vi=new yt(3e4,6e4);class ji{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!bi().grecaptcha}load(e,t=""){return ut(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(bi().grecaptcha):new Promise(((n,i)=>{const r=bi().setTimeout((()=>{i(st(e,"network-request-failed"))}),Vi.get());bi()[Fi]=()=>{bi().clearTimeout(r),delete bi()[Fi];const s=bi().grecaptcha;if(!s)return void i(st(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)};Pi(`https://www.google.com/recaptcha/api.js??${b({onload:Fi,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(r),i(st(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!bi().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Bi{async load(e){return new xi(e)}clearedOneInstance(){}}const qi="recaptcha",zi={theme:"light",type:"image"};class Hi{constructor(e,t=Object.assign({},zi),n){this.parameters=t,this.type=qi,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=nn(n),this.isInvisible="invisible"===this.parameters.size,ut("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const i="string"==typeof e?document.getElementById(e):e;ut(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Bi:new ji,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const i=e=>{e&&(this.tokenChangeListeners.delete(i),n(e))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){ut(!this.parameters.sitekey,this.auth,"argument-error"),ut(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ut("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=bi()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){ut(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ut(mt()&&!_i(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await Tt(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);ut(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ut(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class $i{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=gn._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Ki(e,t,n){var i;const r=await n.verify();try{let s;if(ut("string"==typeof r,e,"argument-error"),ut(n.type===qi,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){ut("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Tt(e,"POST","/v2/accounts/mfaEnrollment:start",_t(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{ut("signin"===t.type,e,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;ut(n,e,"missing-multi-factor-info");const o=await function(e,t){return Tt(e,"POST","/v2/accounts/mfaSignIn:start",_t(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Tt(e,"POST","/v1/accounts:sendVerificationCode",_t(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}}class Gi{constructor(e){this.providerId=Gi.PROVIDER_ID,this.auth=nn(e)}verifyPhoneNumber(e,t){return Ki(this.auth,e,A(t))}static credential(e,t){return gn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Gi.credentialFromTaggedObject(t)}static credentialFromError(e){return Gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?gn._fromTokenResponse(t,n):null}}function Wi(e,t){return t?ft(t):(ut(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Gi.PROVIDER_ID="phone",Gi.PHONE_SIGN_IN_METHOD="phone";class Qi extends cn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Xi(e){return Fn(e.auth,new Qi(e),e.bypassAuthState)}function Yi(e){const{auth:t,user:n}=e;return ut(n,t,"internal-error"),Un(n,new Qi(e),e.bypassAuthState)}async function Ji(e){const{auth:t,user:n}=e;return ut(n,t,"internal-error"),Mn(n,new Qi(e),e.bypassAuthState)}class Zi{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Xi;case"linkViaPopup":case"linkViaRedirect":return Ji;case"reauthViaPopup":case"reauthViaRedirect":return Yi;default:rt(this.auth,"internal-error")}}resolve(e){ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const er=new yt(2e3,1e4);async function tr(e,t,n){const i=nn(e);at(e,t,wn);const r=Wi(i,n);return new nr(i,"signInViaPopup",t,r).executeNotNull()}class nr extends Zi{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,nr.currentPopupAction&&nr.currentPopupAction.cancel(),nr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ut(e,this.auth,"internal-error"),e}async onExecution(){ht(1===this.filter.length,"Popup operations only handle one event");const e=wi();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(st(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(st(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(st(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,er.get())};e()}}nr.currentPopupAction=null;const ir=new Map;class rr extends Zi{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ir.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=cr(t),i=ar(e);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ir.set(this.auth._key(),e)}return this.bypassAuthState||ir.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function sr(e,t){return ar(e)._set(cr(t),"true")}function or(e,t){ir.set(e._key(),t)}function ar(e){return ft(e._redirectPersistence)}function cr(e){return Bt("pendingRedirect",e.config.apiKey,e.name)}function ur(e,t,n){return async function(e,t,n){const i=nn(e);at(e,t,wn);const r=Wi(i,n);return await sr(r,i),r._openRedirect(i,t,"signInViaRedirect")}(e,t,n)}function lr(e,t,n){return async function(e,t,n){const i=A(e);at(i.auth,t,wn);const r=Wi(i.auth,n);await sr(r,i.auth);const s=await fr(i);return r._openRedirect(i.auth,t,"reauthViaRedirect",s)}(e,t,n)}function hr(e,t,n){return async function(e,t,n){const i=A(e);at(i.auth,t,wn);const r=Wi(i.auth,n);await xn(!1,i,t.providerId),await sr(r,i.auth);const s=await fr(i);return r._openRedirect(i.auth,t,"linkViaRedirect",s)}(e,t,n)}async function dr(e,t,n=!1){const i=nn(e),r=Wi(i,t),s=new rr(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}async function fr(e){const t=wi(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class pr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return gr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!gr(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(st(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(mr(e))}saveEventToCache(e){this.cachedEventUids.add(mr(e)),this.lastProcessedEventTime=Date.now()}}function mr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function gr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function yr(e,t={}){return Tt(e,"GET","/v1/projects",t)}const vr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wr=/^https?/;function Ir(e){const t=pt(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!wr.test(n))return!1;if(vr.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const br=new yt(3e4,6e4);function _r(){const e=bi().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Tr=null;function Er(e){return Tr=Tr||function(e){return new Promise(((t,n)=>{var i,r,s;function o(){_r(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{_r(),n(st(e,"network-request-failed"))},timeout:br.get()})}if(null===(r=null===(i=bi().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=bi().gapi)||void 0===s?void 0:s.load)){const t=Li("iframefcb");return bi()[t]=()=>{gapi.load?o():n(st(e,"network-request-failed"))},Pi(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Tr=null,e}))}(e),Tr}const kr=new yt(5e3,15e3),Sr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ar=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Cr(e){const t=e.config;ut(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?vt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:ye},r=Ar.get(e.config.apiHost);r&&(i.eid=r);const s=e._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${b(i).slice(1)}`}const Nr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Rr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Dr(e,t,n,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const u=Object.assign(Object.assign({},Nr),{width:i.toString(),height:r.toString(),top:s,left:o}),l=c().toLowerCase();n&&(a=Kt(l)?"_blank":n),Ht(l)&&(t=t||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=c()){var t;return Yt(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new Rr(null);const d=window.open(t||"",a,h);ut(d,e,"popup-blocked");try{d.focus()}catch(e){}return new Rr(d)}const Or="__/auth/handler",Pr="emulator/auth/handler";function Lr(e,t,n,i,r,s){ut(e.config.authDomain,e,"auth-domain-config-required"),ut(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:ye,eventId:r};if(t instanceof wn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof In){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${Or}`;return vt(e,Pr)}(e)}?${b(a).slice(1)}`}const Mr="webStorageSupport";const xr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=yi,this._completeRedirectFn=dr,this._overrideRedirectResult=or}async _openPopup(e,t,n,i){var r;ht(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()");return Dr(e,Lr(e,t,n,pt(),i),wi())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=Lr(e,t,n,pt(),i),bi().location.href=r,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(ht(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Er(e),n=bi().gapi;return ut(n,e,"internal-error"),t.open({where:document.body,url:Cr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Sr,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=st(e,"network-request-failed"),s=bi().setTimeout((()=>{i(r)}),kr.get());function o(){bi().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{i(r)}))}))))}(e),n=new pr(e);return t.register("authEvent",(t=>{ut(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Mr,{type:Mr},(n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i.webStorageSupport;void 0!==r&&t(!!r),rt(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await yr(e);for(const e of t)try{if(Ir(e))return}catch(e){}rt(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Jt()||$t()||Yt()}};class Ur extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return lt("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Ur(e)}_finalizeEnroll(e,t,n){return function(e,t){return Tt(e,"POST","/v2/accounts/mfaEnrollment:finalize",_t(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return Tt(e,"POST","/v2/accounts/mfaSignIn:finalize",_t(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Fr{constructor(){}static assertion(e){return Ur._fromCredential(e)}}Fr.FACTOR_ID="phone";var Vr,jr="@firebase/auth",Br="0.20.4";class qr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ut(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function zr(){return window}Vr="Browser",he(new C("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),{apiKey:r,authDomain:s}=n.options;return((e,n)=>{ut(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),ut(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const i={apiKey:r,authDomain:s,clientPlatform:Vr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zt(Vr)},o=new tn(e,n,i);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(ft);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,i)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),he(new C("auth-internal",(e=>(e=>new qr(e))(nn(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),_e(jr,Br,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Vr)),_e(jr,Br,"esm2017");async function Hr(e,t,n){var i;const{BuildInfo:r}=zr();ht(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(ht(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return Yt()?o.ibi=r.packageName:Wt()?o.apn=r.packageName:rt(e,"operation-not-supported-in-this-environment"),r.displayName&&(o.appDisplayName=r.displayName),o.sessionId=s,Lr(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,o)}function $r(e){const{cordova:t}=zr();return new Promise((n=>{t.plugins.browsertab.isAvailable((i=>{let r=null;i?t.plugins.browsertab.openUrl(e):r=t.InAppBrowser.open(e,function(e=c()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(r)}))}))}class Kr extends pr{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function Gr(e){const t=await Xr()._get(Yr(e));return t&&await Xr()._remove(Yr(e)),t}function Wr(e,t){var n,i;const r=function(e){const t=Jr(e),n=t.link?decodeURIComponent(t.link):void 0,i=Jr(n).link,r=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Jr(r).link||r||i||n||e}(t);if(r.includes("/__/auth/callback")){const t=Jr(r),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(i=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===i?void 0:i[1],a=o?st(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:r,postBody:null}}return null}function Qr(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function Xr(){return ft(mi)}function Yr(e){return Bt("authEvent",e.config.apiKey,e.name)}function Jr(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return _(n.join("?"))}const Zr=class{constructor(){this._redirectPersistence=yi,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=dr,this._overrideRedirectResult=or}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Kr(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){rt(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,i){!function(e){var t,n,i,r,s,o,a,c,u,l;const h=zr();ut("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),ut(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),ut("function"==typeof(null===(s=null===(r=null===(i=null==h?void 0:h.cordova)||void 0===i?void 0:i.plugins)||void 0===r?void 0:r.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ut("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ut("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const r=await this._initialize(e);await r.initialized(),r.resetRedirect(),ir.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Qr(),postBody:null,tenantId:e.tenantId,error:st(e,"no-auth-event")}}(e,n,i);await function(e,t){return Xr()._set(Yr(e),t)}(e,s);const o=await Hr(e,s,t);return async function(e,t,n){const{cordova:i}=zr();let r=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=i.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(st(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),Wt()&&document.addEventListener("visibilitychange",l,!1),r=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{r()}}(e,r,await $r(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=zr(),n={};Yt()?n.iosBundleId=t.packageName:Wt()?n.androidPackageName=t.packageName:rt(e,"operation-not-supported-in-this-environment"),await yr(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:i,BuildInfo:r}=zr(),s=setTimeout((async()=>{await Gr(e),t.onEvent(es())}),500),o=async n=>{clearTimeout(s);const i=await Gr(e);let r=null;i&&(null==n?void 0:n.url)&&(r=Wr(i,n.url)),t.onEvent(r||es())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=i,c=`${r.packageName.toLowerCase()}://`;zr().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function es(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:st("no-auth-event")}}function ts(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function ns(e=c()){return!("file:"!==ts()&&"ionic:"!==ts()&&"capacitor:"!==ts()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function is(e=c()){return f()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=c()){return/Edge\/\d+/.test(e)}(e)}function rs(){try{const e=self.localStorage,t=wi();if(e)return e.setItem(t,"1"),e.removeItem(t),!is()||p()}catch(e){return ss()&&p()}return!1}function ss(){return void 0!==e.g&&"WorkerGlobalScope"in e.g&&"importScripts"in e.g}function os(){return("http:"===ts()||"https:"===ts()||h()||ns())&&!(d()||l())&&rs()&&!ss()}function as(){return ns()&&"undefined"!=typeof document}const cs={LOCAL:"local",NONE:"none",SESSION:"session"},us=ut,ls="persistence";async function hs(e){await e._initializationPromise;const t=ds(),n=Bt(ls,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function ds(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const fs=ut;class ps{constructor(){this.browserResolver=ft(xr),this.cordovaResolver=ft(Zr),this.underlyingResolver=null,this._redirectPersistence=yi,this._completeRedirectFn=dr,this._overrideRedirectResult=or}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,i)}async _openRedirect(e,t,n,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,i)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return as()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return fs(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!as()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function ms(e){return e.unwrap()}function gs(e,t){var n,i;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null===(i=t)||void 0===i?void 0:i.code)){t.resolver=new Is(e,function(e,t){var n;const i=A(e),r=t;return ut(t.customData.operationType,i,"argument-error"),ut(null===(n=r.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,i,"argument-error"),ui._fromError(i,r)}(e,t))}else if(r){const e=ys(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}function ys(e){const{_tokenResponse:t}=e instanceof m?e.customData:e;if(!t)return null;if(!(e instanceof m)&&"temporaryProof"in t&&"phoneNumber"in t)return Gi.credentialFromResult(e);const n=t.providerId;if(!n||n===He)return null;let i;switch(n){case ze:i=Tn;break;case Be:i=_n;break;case qe:i=En;break;case $e:i=An;break;default:const{oauthIdToken:e,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return r||s||e||o?o?n.startsWith("saml.")?kn._create(n,o):pn._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:r}):new bn(n).credential({idToken:e,accessToken:r,rawNonce:a}):null}return e instanceof m?i.credentialFromError(e):i.credentialFromResult(e)}function vs(e,t){return t.catch((t=>{throw t instanceof m&&gs(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(i=e,ys(i)),additionalUserInfo:ai(e),user:bs.getOrCreate(n)};var i}))}async function ws(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>vs(e,n.confirm(t))}}class Is{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return vs(ms(this.auth),this.resolver.resolveSignIn(e))}}class bs{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=A(e);return hi.has(t)||hi.set(t,li._fromUser(t)),hi.get(t)}(e)}static getOrCreate(e){return bs.USER_MAP.has(e)||bs.USER_MAP.set(e,new bs(e)),bs.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return vs(this.auth,jn(this._delegate,e))}async linkWithPhoneNumber(e,t){return ws(this.auth,async function(e,t,n){const i=A(e);await xn(!1,i,"phone");const r=await Ki(i.auth,t,A(n));return new $i(r,(e=>jn(i,e)))}(this._delegate,e,t))}async linkWithPopup(e){return vs(this.auth,async function(e,t,n){const i=A(e);at(i.auth,t,wn);const r=Wi(i.auth,n);return new nr(i.auth,"linkViaPopup",t,r,i).executeNotNull()}(this._delegate,e,ps))}async linkWithRedirect(e){return await hs(nn(this.auth)),hr(this._delegate,e,ps)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return vs(this.auth,Bn(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return ws(this.auth,async function(e,t,n){const i=A(e),r=await Ki(i.auth,t,A(n));return new $i(r,(e=>Bn(i,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return vs(this.auth,async function(e,t,n){const i=A(e);at(i.auth,t,wn);const r=Wi(i.auth,n);return new nr(i.auth,"reauthViaPopup",t,r,i).executeNotNull()}(this._delegate,e,ps))}async reauthenticateWithRedirect(e){return await hs(nn(this.auth)),lr(this._delegate,e,ps)}sendEmailVerification(e){return Yn(this._delegate,e)}async unlink(e){return await Ln(this._delegate,e),this}updateEmail(e){return function(e,t){return ei(A(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return ei(A(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await Mn(A(e),t)}(this._delegate,e)}updateProfile(e){return Zn(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Jn(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}bs.USER_MAP=new WeakMap;const _s=ut;class Ts{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;_s(n,"invalid-api-key",{appName:e.name}),_s(n,"invalid-api-key",{appName:e.name});const i="undefined"!=typeof window?ps:void 0;this._delegate=t.initialize({options:{persistence:ks(n,e.name),popupRedirectResolver:i}}),this._delegate._updateErrorMap(Ze),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?bs.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){sn(this._delegate,e,t)}applyActionCode(e){return Gn(this._delegate,e)}checkActionCode(e){return Wn(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await un(A(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return vs(this._delegate,async function(e,t,n){const i=nn(e),r=await Cn(i,{returnSecureToken:!0,email:t,password:n}),s=await Nn._fromIdTokenResponse(i,"signIn",r);return await i._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return Xn(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=yn.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){_s(os(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await nn(e)._initializationPromise,dr(e,t,!1)}(this._delegate,ps);return e?vs(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){nn(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:i,error:r,complete:s}=Es(e,t,n);return this._delegate.onAuthStateChanged(i,r,s)}onIdTokenChanged(e,t,n){const{next:i,error:r,complete:s}=Es(e,t,n);return this._delegate.onIdTokenChanged(i,r,s)}sendSignInLinkToEmail(e,t){return Qn(this._delegate,e,t)}sendPasswordResetEmail(e,t){return Kn(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){us(Object.values(cs).includes(t),e,"invalid-persistence-type"),d()?us(t!==cs.SESSION,e,"unsupported-persistence-type"):l()?us(t===cs.NONE,e,"unsupported-persistence-type"):ss()?us(t===cs.NONE||t===cs.LOCAL&&p(),e,"unsupported-persistence-type"):us(t===cs.NONE||rs(),e,"unsupported-persistence-type")}(this._delegate,e),e){case cs.SESSION:t=yi;break;case cs.LOCAL:t=await ft(Oi)._isAvailable()?Oi:mi;break;case cs.NONE:t=jt;break;default:return rt("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return vs(this._delegate,async function(e){var t;const n=nn(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Nn({user:n.currentUser,providerId:null,operationType:"signIn"});const i=await Cn(n,{returnSecureToken:!0}),r=await Nn._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(r.user),r}(this._delegate))}signInWithCredential(e){return vs(this._delegate,Vn(this._delegate,e))}signInWithCustomToken(e){return vs(this._delegate,qn(this._delegate,e))}signInWithEmailAndPassword(e,t){return vs(this._delegate,function(e,t,n){return Vn(A(e),vn.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return vs(this._delegate,async function(e,t,n){const i=A(e),r=vn.credentialWithLink(t,n||pt());return ut(r._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),Vn(i,r)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return ws(this._delegate,async function(e,t,n){const i=nn(e),r=await Ki(i,t,A(n));return new $i(r,(e=>Vn(i,e)))}(this._delegate,e,t))}async signInWithPopup(e){return _s(os(),this._delegate,"operation-not-supported-in-this-environment"),vs(this._delegate,tr(this._delegate,e,ps))}async signInWithRedirect(e){return _s(os(),this._delegate,"operation-not-supported-in-this-environment"),await hs(this._delegate),ur(this._delegate,e,ps)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await Wn(A(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Es(e,t,n){let i=e;"function"!=typeof e&&({next:i,error:t,complete:n}=e);const r=i;return{next:e=>r(e&&bs.getOrCreate(e)),error:t,complete:n}}function ks(e,t){const n=function(e,t){const n=ds();if(!n)return[];const i=Bt(ls,e,t);switch(n.getItem(i)){case cs.NONE:return[jt];case cs.LOCAL:return[Oi,yi];case cs.SESSION:return[yi];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(Oi)||n.push(Oi),"undefined"!=typeof window)for(const e of[mi,yi])n.includes(e)||n.push(e);return n.includes(jt)||n.push(jt),n}Ts.Persistence=cs;class Ss{constructor(){this.providerId="phone",this._delegate=new Gi(ms(Ve.auth()))}static credential(e,t){return Gi.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Ss.PHONE_SIGN_IN_METHOD=Gi.PHONE_SIGN_IN_METHOD,Ss.PROVIDER_ID=Gi.PROVIDER_ID;const As=ut;class Cs{constructor(e,t,n=Ve.app()){var i;As(null===(i=n.options)||void 0===i?void 0:i.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Hi(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var Ns;(Ns=Ve).INTERNAL.registerComponent(new C("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new Ts(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Ke,PASSWORD_RESET:Ge,RECOVER_EMAIL:We,REVERT_SECOND_FACTOR_ADDITION:Qe,VERIFY_AND_CHANGE_EMAIL:Xe,VERIFY_EMAIL:Ye}},EmailAuthProvider:vn,FacebookAuthProvider:_n,GithubAuthProvider:En,GoogleAuthProvider:Tn,OAuthProvider:bn,SAMLAuthProvider:Sn,PhoneAuthProvider:Ss,PhoneMultiFactorGenerator:Fr,RecaptchaVerifier:Cs,TwitterAuthProvider:An,Auth:Ts,AuthCredential:cn,Error:m}).setInstantiationMode("LAZY").setMultipleInstances(!1)),Ns.registerVersion("@firebase/auth-compat","0.2.17");Ve.registerVersion("firebase","9.8.4","app-compat");var Rs,Ds="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e.g?e.g:"undefined"!=typeof self?self:{},Os={},Ps=Ps||{},Ls=Ds||self;function Ms(){}function xs(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Us(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Fs="closure_uid_"+(1e9*Math.random()>>>0),Vs=0;function js(e,t,n){return e.call.apply(e.bind,arguments)}function Bs(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function qs(e,t,n){return(qs=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?js:Bs).apply(null,arguments)}function zs(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Hs(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function $s(){this.s=this.s,this.o=this.o}var Ks={};$s.prototype.s=!1,$s.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,Fs)&&e[Fs]||(e[Fs]=++Vs)}(this);delete Ks[e]}},$s.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Gs=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},Ws=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const i=e.length,r="string"==typeof e?e.split(""):e;for(let s=0;s<i;s++)s in r&&t.call(n,r[s],s,e)};function Qs(e){return Array.prototype.concat.apply([],arguments)}function Xs(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function Ys(e){return/^[\s\xa0]*$/.test(e)}var Js,Zs=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function eo(e,t){return-1!=e.indexOf(t)}function to(e,t){return e<t?-1:e>t?1:0}e:{var no=Ls.navigator;if(no){var io=no.userAgent;if(io){Js=io;break e}}Js=""}function ro(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function so(e){const t={};for(const n in e)t[n]=e[n];return t}var oo="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ao(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t],i)e[n]=i[n];for(let t=0;t<oo.length;t++)n=oo[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function co(e){return co[" "](e),e}co[" "]=Ms;var uo,lo,ho=eo(Js,"Opera"),fo=eo(Js,"Trident")||eo(Js,"MSIE"),po=eo(Js,"Edge"),mo=po||fo,go=eo(Js,"Gecko")&&!(eo(Js.toLowerCase(),"webkit")&&!eo(Js,"Edge"))&&!(eo(Js,"Trident")||eo(Js,"MSIE"))&&!eo(Js,"Edge"),yo=eo(Js.toLowerCase(),"webkit")&&!eo(Js,"Edge");function vo(){var e=Ls.document;return e?e.documentMode:void 0}e:{var wo="",Io=(lo=Js,go?/rv:([^\);]+)(\)|;)/.exec(lo):po?/Edge\/([\d\.]+)/.exec(lo):fo?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(lo):yo?/WebKit\/(\S+)/.exec(lo):ho?/(?:Version)[ \/]?(\S+)/.exec(lo):void 0);if(Io&&(wo=Io?Io[1]:""),fo){var bo=vo();if(null!=bo&&bo>parseFloat(wo)){uo=String(bo);break e}}uo=wo}var _o,To={};function Eo(){return function(e){var t=To;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){let e=0;const t=Zs(String(uo)).split("."),n=Zs("9").split("."),i=Math.max(t.length,n.length);for(let o=0;0==e&&o<i;o++){var r=t[o]||"",s=n[o]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==r[0].length&&0==s[0].length)break;e=to(0==r[1].length?0:parseInt(r[1],10),0==s[1].length?0:parseInt(s[1],10))||to(0==r[2].length,0==s[2].length)||to(r[2],s[2]),r=r[3],s=s[3]}while(0==e)}return 0<=e}))}if(Ls.document&&fo){var ko=vo();_o=ko||(parseInt(uo,10)||void 0)}else _o=void 0;var So=_o,Ao=function(){if(!Ls.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Ls.addEventListener("test",Ms,t),Ls.removeEventListener("test",Ms,t)}catch(e){}return e}();function Co(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function No(e,t){if(Co.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(go){e:{try{co(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Ro[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&No.Z.h.call(this)}}Co.prototype.h=function(){this.defaultPrevented=!0},Hs(No,Co);var Ro={2:"touch",3:"pen",4:"mouse"};No.prototype.h=function(){No.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Do="closure_listenable_"+(1e6*Math.random()|0),Oo=0;function Po(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ia=r,this.key=++Oo,this.ca=this.fa=!1}function Lo(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Mo(e){this.src=e,this.g={},this.h=0}function xo(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=Gs(r,t);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Lo(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Uo(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==i)return r}return-1}Mo.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Uo(e,t,i,r);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Po(t,this.src,s,!!i,r)).fa=n,e.push(t)),t};var Fo="closure_lm_"+(1e6*Math.random()|0),Vo={};function jo(e,t,n,i,r){if(i&&i.once)return qo(e,t,n,i,r);if(Array.isArray(t)){for(var s=0;s<t.length;s++)jo(e,t[s],n,i,r);return null}return n=Qo(n),e&&e[Do]?e.N(t,n,Us(i)?!!i.capture:!!i,r):Bo(e,t,n,!1,i,r)}function Bo(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var o=Us(r)?!!r.capture:!!r,a=Go(e);if(a||(e[Fo]=a=new Mo(e)),(n=a.add(t,n,i,o,s)).proxy)return n;if(i=function(){function e(n){return t.call(e.src,e.listener,n)}var t=Ko;return e}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)Ao||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent($o(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function qo(e,t,n,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)qo(e,t[s],n,i,r);return null}return n=Qo(n),e&&e[Do]?e.O(t,n,Us(i)?!!i.capture:!!i,r):Bo(e,t,n,!0,i,r)}function zo(e,t,n,i,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)zo(e,t[s],n,i,r);else i=Us(i)?!!i.capture:!!i,n=Qo(n),e&&e[Do]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=Uo(s=e.g[t],n,i,r))&&(Lo(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=Go(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Uo(t,n,i,r)),(n=-1<e?t[e]:null)&&Ho(n))}function Ho(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[Do])xo(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent($o(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=Go(t))?(xo(n,e),0==n.h&&(n.src=null,t[Fo]=null)):Lo(e)}}}function $o(e){return e in Vo?Vo[e]:Vo[e]="on"+e}function Ko(e,t){if(e.ca)e=!0;else{t=new No(t,this);var n=e.listener,i=e.ia||e.src;e.fa&&Ho(e),e=n.call(i,t)}return e}function Go(e){return(e=e[Fo])instanceof Mo?e:null}var Wo="__closure_events_fn_"+(1e9*Math.random()>>>0);function Qo(e){return"function"==typeof e?e:(e[Wo]||(e[Wo]=function(t){return e.handleEvent(t)}),e[Wo])}function Xo(){$s.call(this),this.i=new Mo(this),this.P=this,this.I=null}function Yo(e,t){var n,i=e.I;if(i)for(n=[];i;i=i.I)n.push(i);if(e=e.P,i=t.type||t,"string"==typeof t)t=new Co(t,e);else if(t instanceof Co)t.target=t.target||e;else{var r=t;ao(t=new Co(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=Jo(o,i,!0,t)&&r}if(r=Jo(o=t.g=e,i,!0,t)&&r,r=Jo(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=Jo(o=t.g=n[s],i,!1,t)&&r}function Jo(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&xo(e.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}Hs(Xo,$s),Xo.prototype[Do]=!0,Xo.prototype.removeEventListener=function(e,t,n,i){zo(this,e,t,n,i)},Xo.prototype.M=function(){if(Xo.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)Lo(n[i]);delete t.g[e],t.h--}}this.I=null},Xo.prototype.N=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},Xo.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var Zo=Ls.JSON.stringify;function ea(){var e=aa;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var ta,na=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new ia),(e=>e.reset()));class ia{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ra(e){Ls.setTimeout((()=>{throw e}),0)}function sa(e,t){ta||function(){var e=Ls.Promise.resolve(void 0);ta=function(){e.then(ca)}}(),oa||(ta(),oa=!0),aa.add(e,t)}var oa=!1,aa=new class{constructor(){this.h=this.g=null}add(e,t){const n=na.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function ca(){for(var e;e=ea();){try{e.h.call(e.g)}catch(e){ra(e)}var t=na;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}oa=!1}function ua(e,t){Xo.call(this),this.h=e||1,this.g=t||Ls,this.j=qs(this.kb,this),this.l=Date.now()}function la(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function ha(e,t,n){if("function"==typeof e)n&&(e=qs(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=qs(e.handleEvent,e)}return 2147483647<Number(t)?-1:Ls.setTimeout(e,t||0)}function da(e){e.g=ha((()=>{e.g=null,e.i&&(e.i=!1,da(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Hs(ua,Xo),(Rs=ua.prototype).da=!1,Rs.S=null,Rs.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Yo(this,"tick"),this.da&&(la(this),this.start()))}},Rs.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Rs.M=function(){ua.Z.M.call(this),la(this),delete this.g};class fa extends $s{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:da(this)}M(){super.M(),this.g&&(Ls.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function pa(e){$s.call(this),this.h=e,this.g={}}Hs(pa,$s);var ma=[];function ga(e,t,n,i){Array.isArray(n)||(n&&(ma[0]=n.toString()),n=ma);for(var r=0;r<n.length;r++){var s=jo(t,n[r],i||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ya(e){ro(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ho(e)}),e),e.g={}}function va(){this.g=!0}function wa(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return Zo(n)}catch(e){return t}}(e,n)+(i?" "+i:"")}))}pa.prototype.M=function(){pa.Z.M.call(this),ya(this)},pa.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},va.prototype.Aa=function(){this.g=!1},va.prototype.info=function(){};var Ia={},ba=null;function _a(){return ba=ba||new Xo}function Ta(e){Co.call(this,Ia.Ma,e)}function Ea(e){const t=_a();Yo(t,new Ta(t,e))}function ka(e,t){Co.call(this,Ia.STAT_EVENT,e),this.stat=t}function Sa(e){const t=_a();Yo(t,new ka(t,e))}function Aa(e,t){Co.call(this,Ia.Na,e),this.size=t}function Ca(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Ls.setTimeout((function(){e()}),t)}Ia.Ma="serverreachability",Hs(Ta,Co),Ia.STAT_EVENT="statevent",Hs(ka,Co),Ia.Na="timingevent",Hs(Aa,Co);var Na={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ra={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Da(){}function Oa(e){return e.h||(e.h=e.i())}function Pa(){}Da.prototype.h=null;var La,Ma={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function xa(){Co.call(this,"d")}function Ua(){Co.call(this,"c")}function Fa(){}function Va(e,t,n,i){this.l=e,this.j=t,this.m=n,this.X=i||1,this.V=new pa(this),this.P=Ba,e=mo?125:void 0,this.W=new ua(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ja}function ja(){this.i=null,this.g="",this.h=!1}Hs(xa,Co),Hs(Ua,Co),Hs(Fa,Da),Fa.prototype.g=function(){return new XMLHttpRequest},Fa.prototype.i=function(){return{}},La=new Fa;var Ba=45e3,qa={},za={};function Ha(e,t,n){e.K=1,e.v=fc(ac(t)),e.s=n,e.U=!0,$a(e,null)}function $a(e,t){e.F=Date.now(),Qa(e),e.A=ac(e.v);var n=e.A,i=e.X;Array.isArray(i)||(i=[String(i)]),Sc(n.h,"t",i),e.C=0,n=e.l.H,e.h=new ja,e.g=Su(e.l,n?t:null,!e.s),0<e.O&&(e.L=new fa(qs(e.Ia,e,e.g),e.O)),ga(e.V,e.g,"readystatechange",e.gb),t=e.H?so(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ea(1),function(e,t,n,i,r,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function Ka(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function Ga(e,t,n){let i,r=!0;for(;!e.I&&e.C<n.length;){if(i=Wa(e,n),i==za){4==t&&(e.o=4,Sa(14),r=!1),wa(e.j,e.m,null,"[Incomplete Response]");break}if(i==qa){e.o=4,Sa(15),wa(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}wa(e.j,e.m,i,null),ec(e,i)}Ka(e)&&i!=za&&i!=qa&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Sa(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),vu(t),t.L=!0,Sa(11))):(wa(e.j,e.m,n,"[Invalid Chunked Response]"),Za(e),Ja(e))}function Wa(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?za:(n=Number(t.substring(n,i)),isNaN(n)?qa:(i+=1)+n>t.length?za:(t=t.substr(i,n),e.C=i+n,t))}function Qa(e){e.Y=Date.now()+e.P,Xa(e,e.P)}function Xa(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ca(qs(e.eb,e),t)}function Ya(e){e.B&&(Ls.clearTimeout(e.B),e.B=null)}function Ja(e){0==e.l.G||e.I||bu(e.l,e)}function Za(e){Ya(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,la(e.W),ya(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function ec(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Oc(n.i,e)))if(n.I=e.N,!e.J&&Oc(n.i,e)&&3==n.G){try{var i=n.Ca.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Iu(n),uu(n)}yu(n),Sa(18)}}else n.ta=r[1],0<n.ta-n.U&&37500>r[2]&&n.N&&0==n.A&&!n.v&&(n.v=Ca(qs(n.ab,n),6e3));if(1>=Dc(n.i)&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else Tu(n,11)}else if((e.J||n.g==e)&&Iu(n),!Ys(t))for(r=n.Ca.g.parse(t),t=0;t<r.length;t++){let u=r[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const r=u[4];null!=r&&(n.za=r,n.h.info("SVER="+n.za));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(i=1.5*l,n.K=i,n.h.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.i;!s.g&&(eo(e,"spdy")||eo(e,"quic")||eo(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(Pc(s,s.h),s.h=null))}if(i.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.sa=e,dc(i.F,i.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((i=n).oa=ku(i,i.H?i.la:null,i.W),o.J){Lc(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(Ya(a),Qa(a)),i.g=o}else gu(i);0<n.l.length&&du(n)}else"stop"!=u[0]&&"close"!=u[0]||Tu(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Tu(n,7):cu(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}Ea(4)}catch(e){}}function tc(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(xs(e)||"string"==typeof e)Ws(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(xs(e)||"string"==typeof e){n=[];for(var i=e.length,r=0;r<i;r++)n.push(r)}else for(r in n=[],i=0,e)n[i++]=r;i=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(xs(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length;for(var s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}}function nc(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(e)if(e instanceof nc)for(n=e.T(),i=0;i<n.length;i++)this.set(n[i],e.get(n[i]));else for(i in e)this.set(i,e[i])}function ic(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var i=e.g[t];rc(e.h,i)&&(e.g[n++]=i),t++}e.g.length=n}if(e.i!=e.g.length){var r={};for(n=t=0;t<e.g.length;)rc(r,i=e.g[t])||(e.g[n++]=i,r[i]=1),t++;e.g.length=n}}function rc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(Rs=Va.prototype).setTimeout=function(e){this.P=e},Rs.gb=function(e){e=e.target;const t=this.L;t&&3==iu(e)?t.l():this.Ia(e)},Rs.Ia=function(e){try{if(e==this.g)e:{const l=iu(this.g);var t=this.g.Da();const h=this.g.ba();if(!(3>l)&&(3!=l||mo||this.g&&(this.h.h||this.g.ga()||ru(this.g)))){this.I||4!=l||7==t||Ea(8==t||0>=h?3:2),Ya(this);var n=this.g.ba();this.N=n;t:if(Ka(this)){var i=ru(this.g);e="";var r=i.length,s=4==iu(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Za(this),Ja(this);var o="";break t}this.h.i=new Ls.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:s&&t==r-1});i.splice(0,r),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,i,r,s,o){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.X,l,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ys(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,Sa(12),Za(this),Ja(this);break e}wa(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,ec(this,n)}this.U?(Ga(this,l,o),mo&&this.i&&3==l&&(ga(this.V,this.W,"tick",this.fb),this.W.start())):(wa(this.j,this.m,o,null),ec(this,o)),4==l&&Za(this),this.i&&!this.I&&(4==l?bu(this.l,this):(this.i=!1,Qa(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Sa(12)):(this.o=0,Sa(13)),Za(this),Ja(this)}}}catch(e){}},Rs.fb=function(){if(this.g){var e=iu(this.g),t=this.g.ga();this.C<t.length&&(Ya(this),Ga(this,e,t),this.i&&4!=e&&Qa(this))}},Rs.cancel=function(){this.I=!0,Za(this)},Rs.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(Ea(3),Sa(17)),Za(this),this.o=2,Ja(this)):Xa(this,this.Y-e)},(Rs=nc.prototype).R=function(){ic(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},Rs.T=function(){return ic(this),this.g.concat()},Rs.get=function(e,t){return rc(this.h,e)?this.h[e]:t},Rs.set=function(e,t){rc(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},Rs.forEach=function(e,t){for(var n=this.T(),i=0;i<n.length;i++){var r=n[i],s=this.get(r);e.call(t,s,r,this)}};var sc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function oc(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof oc){this.g=void 0!==t?t:e.g,cc(this,e.j),this.s=e.s,uc(this,e.i),lc(this,e.m),this.l=e.l,t=e.h;var n=new _c;n.i=t.i,t.g&&(n.g=new nc(t.g),n.h=t.h),hc(this,n),this.o=e.o}else e&&(n=String(e).match(sc))?(this.g=!!t,cc(this,n[1]||"",!0),this.s=pc(n[2]||""),uc(this,n[3]||"",!0),lc(this,n[4]),this.l=pc(n[5]||"",!0),hc(this,n[6]||"",!0),this.o=pc(n[7]||"")):(this.g=!!t,this.h=new _c(null,this.g))}function ac(e){return new oc(e)}function cc(e,t,n){e.j=n?pc(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function uc(e,t,n){e.i=n?pc(t,!0):t}function lc(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function hc(e,t,n){t instanceof _c?(e.h=t,function(e,t){t&&!e.j&&(Tc(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Ec(this,t),Sc(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=mc(t,Ic)),e.h=new _c(t,e.g))}function dc(e,t,n){e.h.set(t,n)}function fc(e){return dc(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function pc(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function mc(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,gc),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function gc(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}oc.prototype.toString=function(){var e=[],t=this.j;t&&e.push(mc(t,yc,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(mc(t,yc,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(mc(n,"/"==n.charAt(0)?wc:vc,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",mc(n,bc)),e.join("")};var yc=/[#\/\?@]/g,vc=/[#\?:]/g,wc=/[#\?]/g,Ic=/[#\?@]/g,bc=/#/g;function _c(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Tc(e){e.g||(e.g=new nc,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Ec(e,t){Tc(e),t=Ac(e,t),rc(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,rc((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&ic(e)))}function kc(e,t){return Tc(e),t=Ac(e,t),rc(e.g.h,t)}function Sc(e,t,n){Ec(e,t),0<n.length&&(e.i=null,e.g.set(Ac(e,t),Xs(n)),e.h+=n.length)}function Ac(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Rs=_c.prototype).add=function(e,t){Tc(this),this.i=null,e=Ac(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Rs.forEach=function(e,t){Tc(this),this.g.forEach((function(n,i){Ws(n,(function(n){e.call(t,n,i,this)}),this)}),this)},Rs.T=function(){Tc(this);for(var e=this.g.R(),t=this.g.T(),n=[],i=0;i<t.length;i++)for(var r=e[i],s=0;s<r.length;s++)n.push(t[i]);return n},Rs.R=function(e){Tc(this);var t=[];if("string"==typeof e)kc(this,e)&&(t=Qs(t,this.g.get(Ac(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Qs(t,e[n])}return t},Rs.set=function(e,t){return Tc(this),this.i=null,kc(this,e=Ac(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Rs.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},Rs.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var i=t[n],r=encodeURIComponent(String(i));i=this.R(i);for(var s=0;s<i.length;s++){var o=r;""!==i[s]&&(o+="="+encodeURIComponent(String(i[s]))),e.push(o)}}return this.i=e.join("&")};function Cc(e){this.l=e||Nc,Ls.PerformanceNavigationTiming?e=0<(e=Ls.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(Ls.g&&Ls.g.Ea&&Ls.g.Ea()&&Ls.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Nc=10;function Rc(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Dc(e){return e.h?1:e.g?e.g.size:0}function Oc(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Pc(e,t){e.g?e.g.add(t):e.h=t}function Lc(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Mc(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return Xs(e.i)}function xc(){}function Uc(){this.g=new xc}function Fc(e,t,n){const i=n||"";try{tc(e,(function(e,n){let r=e;Us(e)&&(r=Zo(e)),t.push(i+n+"="+encodeURIComponent(r))}))}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}function Vc(e,t,n,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(e){}}function jc(e){this.l=e.$b||null,this.j=e.ib||!1}function Bc(e,t){Xo.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=qc,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Cc.prototype.cancel=function(){if(this.i=Mc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},xc.prototype.stringify=function(e){return Ls.JSON.stringify(e,void 0)},xc.prototype.parse=function(e){return Ls.JSON.parse(e,void 0)},Hs(jc,Da),jc.prototype.g=function(){return new Bc(this.l,this.j)},jc.prototype.i=function(e){return function(){return e}}({}),Hs(Bc,Xo);var qc=0;function zc(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Hc(e){e.readyState=4,e.l=null,e.j=null,e.A=null,$c(e)}function $c(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Rs=Bc.prototype).open=function(e,t){if(this.readyState!=qc)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,$c(this)},Rs.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Ls).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},Rs.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Hc(this)),this.readyState=qc},Rs.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,$c(this)),this.g&&(this.readyState=3,$c(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Ls.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;zc(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},Rs.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Hc(this):$c(this),3==this.readyState&&zc(this)}},Rs.Ua=function(e){this.g&&(this.response=this.responseText=e,Hc(this))},Rs.Ta=function(e){this.g&&(this.response=e,Hc(this))},Rs.ha=function(){this.g&&Hc(this)},Rs.setRequestHeader=function(e,t){this.v.append(e,t)},Rs.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Rs.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Bc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Kc=Ls.JSON.parse;function Gc(e){Xo.call(this),this.headers=new nc,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Wc,this.K=this.L=!1}Hs(Gc,Xo);var Wc="",Qc=/^https?$/i,Xc=["POST","PUT"];function Yc(e){return"content-type"==e.toLowerCase()}function Jc(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Zc(e),tu(e)}function Zc(e){e.D||(e.D=!0,Yo(e,"complete"),Yo(e,"error"))}function eu(e){if(e.h&&void 0!==Ps&&(!e.C[1]||4!=iu(e)||2!=e.ba()))if(e.v&&4==iu(e))ha(e.Fa,0,e);else if(Yo(e,"readystatechange"),4==iu(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===a){var r=String(e.H).match(sc)[1]||null;if(!r&&Ls.self&&Ls.self.location){var s=Ls.self.location.protocol;r=s.substr(0,s.length-1)}i=!Qc.test(r?r.toLowerCase():"")}n=i}if(n)Yo(e,"complete"),Yo(e,"success");else{e.m=6;try{var o=2<iu(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.ba()+"]",Zc(e)}}finally{tu(e)}}}function tu(e,t){if(e.g){nu(e);const n=e.g,i=e.C[0]?Ms:null;e.g=null,e.C=null,t||Yo(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function nu(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Ls.clearTimeout(e.A),e.A=null)}function iu(e){return e.g?e.g.readyState:0}function ru(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Wc:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function su(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=function(e){let t="";return ro(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):dc(e,t,n))}function ou(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function au(e){this.za=0,this.l=[],this.h=new va,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ou("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ou("baseRetryDelayMs",5e3,e),this.$a=ou("retryDelaySeedMs",1e4,e),this.Ya=ou("forwardChannelMaxRetries",2,e),this.ra=ou("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Cc(e&&e.concurrentRequestLimit),this.Ca=new Uc,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function cu(e){if(lu(e),3==e.G){var t=e.V++,n=ac(e.F);dc(n,"SID",e.J),dc(n,"RID",t),dc(n,"TYPE","terminate"),pu(e,n),(t=new Va(e,e.h,t,void 0)).K=2,t.v=fc(ac(n)),n=!1,Ls.navigator&&Ls.navigator.sendBeacon&&(n=Ls.navigator.sendBeacon(t.v.toString(),"")),!n&&Ls.Image&&((new Image).src=t.v,n=!0),n||(t.g=Su(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Qa(t)}Eu(e)}function uu(e){e.g&&(vu(e),e.g.cancel(),e.g=null)}function lu(e){uu(e),e.u&&(Ls.clearTimeout(e.u),e.u=null),Iu(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Ls.clearTimeout(e.m),e.m=null)}function hu(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&du(e)}function du(e){Rc(e.i)||e.m||(e.m=!0,sa(e.Ha,e),e.C=0)}function fu(e,t){var n;n=t?t.m:e.V++;const i=ac(e.F);dc(i,"SID",e.J),dc(i,"RID",n),dc(i,"AID",e.U),pu(e,i),e.o&&e.s&&su(i,e.o,e.s),n=new Va(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=mu(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Pc(e.i,n),Ha(n,i,t)}function pu(e,t){e.j&&tc({},(function(e,n){dc(t,n,e)}))}function mu(e,t,n){n=Math.min(e.l.length,n);var i=e.j?qs(e.j.Oa,e.j,e):null;e:{var r=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=r[o].h;const a=r[o].g;if(n-=t,0>n)t=Math.max(0,r[o].h-100),s=!1;else try{Fc(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(s){i=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,i}function gu(e){e.g||e.u||(e.Y=1,sa(e.Ga,e),e.A=0)}function yu(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=Ca(qs(e.Ga,e),_u(e,e.A)),e.A++,!0)}function vu(e){null!=e.B&&(Ls.clearTimeout(e.B),e.B=null)}function wu(e){e.g=new Va(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=ac(e.oa);dc(t,"RID","rpc"),dc(t,"SID",e.J),dc(t,"CI",e.N?"0":"1"),dc(t,"AID",e.U),pu(e,t),dc(t,"TYPE","xmlhttp"),e.o&&e.s&&su(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=fc(ac(t)),n.s=null,n.U=!0,$a(n,e)}function Iu(e){null!=e.v&&(Ls.clearTimeout(e.v),e.v=null)}function bu(e,t){var n=null;if(e.g==t){Iu(e),vu(e),e.g=null;var i=2}else{if(!Oc(e.i,t))return;n=t.D,Lc(e.i,t),i=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.F;var r=e.C;Yo(i=_a(),new Aa(i,n,t,r)),du(e)}else gu(e);else if(3==(r=t.o)||0==r&&0<e.I||!(1==i&&function(e,t){return!(Dc(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=Ca(qs(e.Ha,e,t),_u(e,e.C)),e.C++,0)))}(e,t)||2==i&&yu(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),r){case 1:Tu(e,5);break;case 4:Tu(e,10);break;case 3:Tu(e,6);break;default:Tu(e,2)}}function _u(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function Tu(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var i=qs(e.jb,e);n||(n=new oc("//www.google.com/images/cleardot.gif"),Ls.location&&"http"==Ls.location.protocol||cc(n,"https"),fc(n)),function(e,t){const n=new va;if(Ls.Image){const i=new Image;i.onload=zs(Vc,n,i,"TestLoadImage: loaded",!0,t),i.onerror=zs(Vc,n,i,"TestLoadImage: error",!1,t),i.onabort=zs(Vc,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=zs(Vc,n,i,"TestLoadImage: timeout",!1,t),Ls.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(n.toString(),i)}else Sa(2);e.G=0,e.j&&e.j.va(t),Eu(e),lu(e)}function Eu(e){e.G=0,e.I=-1,e.j&&(0==Mc(e.i).length&&0==e.l.length||(e.i.i.length=0,Xs(e.l),e.l.length=0),e.j.ua())}function ku(e,t,n){let i=function(e){return e instanceof oc?ac(e):new oc(e,void 0)}(n);if(""!=i.i)t&&uc(i,t+"."+i.i),lc(i,i.m);else{const e=Ls.location;i=function(e,t,n,i){var r=new oc(null,void 0);return e&&cc(r,e),t&&uc(r,t),n&&lc(r,n),i&&(r.l=i),r}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&ro(e.aa,(function(e,t){dc(i,t,e)})),t=e.D,n=e.sa,t&&n&&dc(i,t,n),dc(i,"VER",e.ma),pu(e,i),i}function Su(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new Gc(new jc({ib:!0})):new Gc(e.qa)).L=e.H,t}function Au(){}function Cu(){if(fo&&!(10<=Number(So)))throw Error("Environmental error: no available transport.")}function Nu(e,t){Xo.call(this),this.g=new au(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Ys(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Ys(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Ou(this)}function Ru(e){xa.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Du(){Ua.call(this),this.status=1}function Ou(e){this.g=e}(Rs=Gc.prototype).ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():La.g(),this.C=this.u?Oa(this.u):Oa(La),this.g.onreadystatechange=qs(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Jc(this,e)}e=n||"";const r=new nc(this.headers);i&&tc(i,(function(e,t){r.set(t,e)})),i=function(e){e:{var t=Yc;const n=e.length,i="string"==typeof e?e.split(""):e;for(let r=0;r<n;r++)if(r in i&&t.call(void 0,i[r],r,e)){t=r;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(r.T()),n=Ls.FormData&&e instanceof Ls.FormData,!(0<=Gs(Xc,t))||i||n||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{nu(this),0<this.B&&((this.K=function(e){return fo&&Eo()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=qs(this.pa,this)):this.A=ha(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Jc(this,e)}},Rs.pa=function(){void 0!==Ps&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Yo(this,"timeout"),this.abort(8))},Rs.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Yo(this,"complete"),Yo(this,"abort"),tu(this))},Rs.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),tu(this,!0)),Gc.Z.M.call(this)},Rs.Fa=function(){this.s||(this.F||this.v||this.l?eu(this):this.cb())},Rs.cb=function(){eu(this)},Rs.ba=function(){try{return 2<iu(this)?this.g.status:-1}catch(e){return-1}},Rs.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Rs.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Kc(t)}},Rs.Da=function(){return this.m},Rs.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Rs=au.prototype).ma=8,Rs.G=1,Rs.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},Rs.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const r=new Va(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=so(s),ao(s,this.P)):s=this.P),null===this.o&&(r.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var i=this.l[n];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=mu(this,r,t),dc(n=ac(this.F),"RID",e),dc(n,"CVER",22),this.D&&dc(n,"X-HTTP-Session-Id",this.D),pu(this,n),this.o&&s&&su(n,this.o,s),Pc(this.i,r),this.Ra&&dc(n,"TYPE","init"),this.ja?(dc(n,"$req",t),dc(n,"SID","null"),r.$=!0,Ha(r,n,null)):Ha(r,n,t),this.G=2}}else 3==this.G&&(e?fu(this,e):0==this.l.length||Rc(this.i)||fu(this))},Rs.Ga=function(){if(this.u=null,wu(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Ca(qs(this.bb,this),e)}},Rs.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Sa(10),uu(this),wu(this))},Rs.ab=function(){null!=this.v&&(this.v=null,uu(this),yu(this),Sa(19))},Rs.jb=function(e){e?(this.h.info("Successfully pinged google.com"),Sa(2)):(this.h.info("Failed to ping google.com"),Sa(1))},(Rs=Au.prototype).xa=function(){},Rs.wa=function(){},Rs.va=function(){},Rs.ua=function(){},Rs.Oa=function(){},Cu.prototype.g=function(e,t){return new Nu(e,t)},Hs(Nu,Xo),Nu.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),sa(qs(e.hb,e,t))),Sa(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=ku(e,null,e.W),du(e)},Nu.prototype.close=function(){cu(this.g)},Nu.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,hu(this.g,t)}else this.v?((t={}).__data__=Zo(e),hu(this.g,t)):hu(this.g,e)},Nu.prototype.M=function(){this.g.j=null,delete this.j,cu(this.g),delete this.g,Nu.Z.M.call(this)},Hs(Ru,xa),Hs(Du,Ua),Hs(Ou,Au),Ou.prototype.xa=function(){Yo(this.g,"a")},Ou.prototype.wa=function(e){Yo(this.g,new Ru(e))},Ou.prototype.va=function(e){Yo(this.g,new Du(e))},Ou.prototype.ua=function(){Yo(this.g,"b")},Cu.prototype.createWebChannel=Cu.prototype.g,Nu.prototype.send=Nu.prototype.u,Nu.prototype.open=Nu.prototype.m,Nu.prototype.close=Nu.prototype.close,Na.NO_ERROR=0,Na.TIMEOUT=8,Na.HTTP_ERROR=6,Ra.COMPLETE="complete",Pa.EventType=Ma,Ma.OPEN="a",Ma.CLOSE="b",Ma.ERROR="c",Ma.MESSAGE="d",Xo.prototype.listen=Xo.prototype.N,Gc.prototype.listenOnce=Gc.prototype.O,Gc.prototype.getLastError=Gc.prototype.La,Gc.prototype.getLastErrorCode=Gc.prototype.Da,Gc.prototype.getStatus=Gc.prototype.ba,Gc.prototype.getResponseJson=Gc.prototype.Qa,Gc.prototype.getResponseText=Gc.prototype.ga,Gc.prototype.send=Gc.prototype.ea;var Pu=Os.createWebChannelTransport=function(){return new Cu},Lu=Os.getStatEventTarget=function(){return _a()},Mu=Os.ErrorCode=Na,xu=Os.EventType=Ra,Uu=Os.Event=Ia,Fu=Os.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Vu=Os.FetchXmlHttpFactory=jc,ju=Os.WebChannel=Pa,Bu=Os.XhrIo=Gc;const qu="@firebase/firestore";class zu{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}zu.UNAUTHENTICATED=new zu(null),zu.GOOGLE_CREDENTIALS=new zu("google-credentials-uid"),zu.FIRST_PARTY=new zu("first-party-uid"),zu.MOCK_USER=new zu("mock-user");let Hu="9.8.4";const $u=new F("@firebase/firestore");function Ku(){return $u.logLevel}function Gu(e,...t){if($u.logLevel<=P.DEBUG){const n=t.map(Xu);$u.debug(`Firestore (${Hu}): ${e}`,...n)}}function Wu(e,...t){if($u.logLevel<=P.ERROR){const n=t.map(Xu);$u.error(`Firestore (${Hu}): ${e}`,...n)}}function Qu(e,...t){if($u.logLevel<=P.WARN){const n=t.map(Xu);$u.warn(`Firestore (${Hu}): ${e}`,...n)}}function Xu(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Yu(e="Unexpected state"){const t=`FIRESTORE (${Hu}) INTERNAL ASSERTION FAILED: `+e;throw Wu(t),new Error(t)}function Ju(e,t){e||Yu()}function Zu(e,t){return e}const el={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tl extends m{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nl{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class il{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rl{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(zu.UNAUTHENTICATED)))}shutdown(){}}class sl{constructor(e){this.t=e,this.currentUser=zu.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new nl;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new nl,e.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const t=r;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},o=e=>{Gu("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Gu("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new nl)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Gu("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ju("string"==typeof t.accessToken),new il(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ju(null===e||"string"==typeof e),new zu(e)}}class ol{constructor(e,t,n){this.type="FirstParty",this.user=zu.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const i=e.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class al{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new ol(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(zu.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class cl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ul{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const n=e=>{null!=e.error&&Gu("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.p;return this.p=e.token,Gu("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{Gu("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?i(e):Gu("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Ju("string"==typeof e.token),this.p=e.token,new cl(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ll(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class hl{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const i=ll(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%e.length))}return n}}function dl(e,t){return e<t?-1:e>t?1:0}function fl(e,t,n){return e.length===t.length&&e.every(((e,i)=>n(e,t[i])))}class pl{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new tl(el.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new tl(el.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new tl(el.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new tl(el.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return pl.fromMillis(Date.now())}static fromDate(e){return pl.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new pl(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?dl(this.nanoseconds,e.nanoseconds):dl(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ml{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ml(e)}static min(){return new ml(new pl(0,0))}static max(){return new ml(new pl(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class gl{constructor(e,t,n){void 0===t?t=0:t>e.length&&Yu(),void 0===n?n=e.length-t:n>e.length-t&&Yu(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===gl.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof gl?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),r=t.get(i);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class yl extends gl{construct(e,t,n){return new yl(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new tl(el.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new yl(t)}static emptyPath(){return new yl([])}}const vl=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wl extends gl{construct(e,t,n){return new wl(e,t,n)}static isValidIdentifier(e){return vl.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wl.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new wl(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const r=()=>{if(0===n.length)throw new tl(el.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new tl(el.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tl(el.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(s=!s,i++):"."!==t||s?(n+=t,i++):(r(),i++)}if(r(),s)throw new tl(el.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new wl(t)}static emptyPath(){return new wl([])}}class Il{constructor(e){this.path=e}static fromPath(e){return new Il(yl.fromString(e))}static fromName(e){return new Il(yl.fromString(e).popFirst(5))}static empty(){return new Il(yl.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===yl.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return yl.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Il(new yl(e.slice()))}}class bl{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}bl.UNKNOWN_ID=-1;function _l(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,r=ml.fromTimestamp(1e9===i?new pl(n+1,0):new pl(n,i));return new El(r,Il.empty(),t)}function Tl(e){return new El(e.readTime,e.key,-1)}class El{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new El(ml.min(),Il.empty(),-1)}static max(){return new El(ml.max(),Il.empty(),-1)}}function kl(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Il.comparator(e.documentKey,t.documentKey),0!==n?n:dl(e.largestBatchId,t.largestBatchId))}const Sl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Al{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Cl(e){if(e.code!==el.FAILED_PRECONDITION||e.message!==Sl)throw e;Gu("LocalStore","Unexpectedly lost primary lease")}class Nl{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Yu(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Nl(((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Nl?t:Nl.resolve(t)}catch(e){return Nl.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Nl.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Nl.reject(t)}static resolve(e){return new Nl(((t,n)=>{t(e)}))}static reject(e){return new Nl(((t,n)=>{n(e)}))}static waitFor(e){return new Nl(((t,n)=>{let i=0,r=0,s=!1;e.forEach((e=>{++i,e.next((()=>{++r,s&&r===i&&t()}),(e=>n(e)))})),s=!0,r===i&&t()}))}static or(e){let t=Nl.resolve(!1);for(const n of e)t=t.next((e=>e?Nl.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,i)=>{n.push(t.call(this,e,i))})),this.waitFor(n)}static mapArray(e,t){return new Nl(((n,i)=>{const r=e.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===r&&n(s)}),(e=>i(e)))}}))}static doWhile(e,t){return new Nl(((n,i)=>{const r=()=>{!0===e()?t().next((()=>{r()}),i):n()};r()}))}}function Rl(e){return"IndexedDbTransactionError"===e.name}class Dl{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.it(e),this.rt=e=>t.writeSequenceNumber(e))}it(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.rt&&this.rt(e),e}}function Ol(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Pl(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ll(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}Dl.ot=-1;class Ml{constructor(e,t){this.comparator=e,this.root=t||Ul.EMPTY}insert(e,t){return new Ml(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ul.BLACK,null,null))}remove(e){return new Ml(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ul.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new xl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new xl(this.root,e,this.comparator,!1)}getReverseIterator(){return new xl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new xl(this.root,e,this.comparator,!0)}}class xl{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ul{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Ul.RED,this.left=null!=i?i:Ul.EMPTY,this.right=null!=r?r:Ul.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new Ul(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ul.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Ul.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ul.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ul.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Yu();if(this.right.isRed())throw Yu();const e=this.left.check();if(e!==this.right.check())throw Yu();return e+(this.isRed()?0:1)}}Ul.EMPTY=null,Ul.RED=!0,Ul.BLACK=!1,Ul.EMPTY=new class{constructor(){this.size=0}get key(){throw Yu()}get value(){throw Yu()}get color(){throw Yu()}get left(){throw Yu()}get right(){throw Yu()}copy(e,t,n,i,r){return this}insert(e,t,n){return new Ul(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Fl{constructor(e){this.comparator=e,this.data=new Ml(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vl(this.data.getIterator())}getIteratorFrom(e){return new Vl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Fl))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Fl(this.comparator);return t.data=e,t}}class Vl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class jl{constructor(e){this.fields=e,e.sort(wl.comparator)}static empty(){return new jl([])}unionWith(e){let t=new Fl(wl.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new jl(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return fl(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Bl{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Bl(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Bl(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return dl(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Bl.EMPTY_BYTE_STRING=new Bl("");const ql=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zl(e){if(Ju(!!e),"string"==typeof e){let t=0;const n=ql.exec(e);if(Ju(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Hl(e.seconds),nanos:Hl(e.nanos)}}function Hl(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function $l(e){return"string"==typeof e?Bl.fromBase64String(e):Bl.fromUint8Array(e)}function Kl(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Gl(e){const t=e.mapValue.fields.__previous_value__;return Kl(t)?Gl(t):t}function Wl(e){const t=zl(e.mapValue.fields.__local_write_time__.timestampValue);return new pl(t.seconds,t.nanos)}class Ql{constructor(e,t,n,i,r,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Xl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Xl("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Xl&&e.projectId===this.projectId&&e.database===this.database}}function Yl(e){return null==e}function Jl(e){return 0===e&&1/e==-1/0}function Zl(e){return"number"==typeof e&&Number.isInteger(e)&&!Jl(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const eh={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function th(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Kl(e)?4:ph(e)?9007199254740991:10:Yu()}function nh(e,t){if(e===t)return!0;const n=th(e);if(n!==th(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Wl(e).isEqual(Wl(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=zl(e.timestampValue),i=zl(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return $l(e.bytesValue).isEqual($l(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Hl(e.geoPointValue.latitude)===Hl(t.geoPointValue.latitude)&&Hl(e.geoPointValue.longitude)===Hl(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Hl(e.integerValue)===Hl(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Hl(e.doubleValue),i=Hl(t.doubleValue);return n===i?Jl(n)===Jl(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return fl(e.arrayValue.values||[],t.arrayValue.values||[],nh);case 10:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Ol(n)!==Ol(i))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===i[e]||!nh(n[e],i[e])))return!1;return!0}(e,t);default:return Yu()}}function ih(e,t){return void 0!==(e.values||[]).find((e=>nh(e,t)))}function rh(e,t){if(e===t)return 0;const n=th(e),i=th(t);if(n!==i)return dl(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return dl(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Hl(e.integerValue||e.doubleValue),i=Hl(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return sh(e.timestampValue,t.timestampValue);case 4:return sh(Wl(e),Wl(t));case 5:return dl(e.stringValue,t.stringValue);case 6:return function(e,t){const n=$l(e),i=$l(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){const t=dl(n[e],i[e]);if(0!==t)return t}return dl(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=dl(Hl(e.latitude),Hl(t.latitude));return 0!==n?n:dl(Hl(e.longitude),Hl(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){const t=rh(n[e],i[e]);if(t)return t}return dl(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===eh.mapValue&&t===eh.mapValue)return 0;if(e===eh.mapValue)return 1;if(t===eh.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){const t=dl(i[e],s[e]);if(0!==t)return t;const o=rh(n[i[e]],r[s[e]]);if(0!==o)return o}return dl(i.length,s.length)}(e.mapValue,t.mapValue);default:throw Yu()}}function sh(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return dl(e,t);const n=zl(e),i=zl(t),r=dl(n.seconds,i.seconds);return 0!==r?r:dl(n.nanos,i.nanos)}function oh(e){return ah(e)}function ah(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=zl(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?$l(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Il.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=ah(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const r of t)i?i=!1:n+=",",n+=`${r}:${ah(e.fields[r])}`;return n+"}"}(e.mapValue):Yu();var t,n}function ch(e){return!!e&&"integerValue"in e}function uh(e){return!!e&&"arrayValue"in e}function lh(e){return!!e&&"nullValue"in e}function hh(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function dh(e){return!!e&&"mapValue"in e}function fh(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Pl(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=fh(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=fh(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ph(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class mh{constructor(e){this.value=e}static empty(){return new mh({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!dh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=fh(t)}setAll(e){let t=wl.emptyPath(),n={},i=[];e.forEach(((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=fh(e):i.push(r.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){const t=this.field(e.popLast());dh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nh(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];dh(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Pl(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new mh(fh(this.value))}}function gh(e){const t=[];return Pl(e.fields,((e,n)=>{const i=new wl([e]);if(dh(n)){const e=gh(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)})),new jl(t)}class yh{constructor(e,t,n,i,r,s){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.data=r,this.documentState=s}static newInvalidDocument(e){return new yh(e,0,ml.min(),ml.min(),mh.empty(),0)}static newFoundDocument(e,t,n){return new yh(e,1,t,ml.min(),n,0)}static newNoDocument(e,t){return new yh(e,2,t,ml.min(),mh.empty(),0)}static newUnknownDocument(e,t){return new yh(e,3,t,ml.min(),mh.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=mh.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=mh.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ml.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof yh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new yh(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class vh{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.ut=null}}function wh(e,t=null,n=[],i=[],r=null,s=null,o=null){return new vh(e,t,n,i,r,s,o)}function Ih(e){const t=Zu(e);if(null===t.ut){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>{return(t=e).field.canonicalString()+t.op.toString()+oh(t.value);var t})).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Yl(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>oh(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>oh(e))).join(",")),t.ut=e}return t.ut}function bh(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Lh(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(n=e.filters[r],i=t.filters[r],n.op!==i.op||!n.field.isEqual(i.field)||!nh(n.value,i.value))return!1;var n,i;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!xh(e.startAt,t.startAt)&&xh(e.endAt,t.endAt)}function _h(e){return Il.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Th extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.ct(e,t,n):new Eh(e,t,n):"array-contains"===t?new Ch(e,n):"in"===t?new Nh(e,n):"not-in"===t?new Rh(e,n):"array-contains-any"===t?new Dh(e,n):new Th(e,t,n)}static ct(e,t,n){return"in"===t?new kh(e,n):new Sh(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.at(rh(t,this.value)):null!==t&&th(this.value)===th(t)&&this.at(rh(t,this.value))}at(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Yu()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Eh extends Th{constructor(e,t,n){super(e,t,n),this.key=Il.fromName(n.referenceValue)}matches(e){const t=Il.comparator(e.key,this.key);return this.at(t)}}class kh extends Th{constructor(e,t){super(e,"in",t),this.keys=Ah("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Sh extends Th{constructor(e,t){super(e,"not-in",t),this.keys=Ah("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ah(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Il.fromName(e.referenceValue)))}class Ch extends Th{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return uh(t)&&ih(t.arrayValue,this.value)}}class Nh extends Th{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&ih(this.value.arrayValue,t)}}class Rh extends Th{constructor(e,t){super(e,"not-in",t)}matches(e){if(ih(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!ih(this.value.arrayValue,t)}}class Dh extends Th{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!uh(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>ih(this.value.arrayValue,e)))}}class Oh{constructor(e,t){this.position=e,this.inclusive=t}}class Ph{constructor(e,t="asc"){this.field=e,this.dir=t}}function Lh(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Mh(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){const s=t[r],o=e.position[r];if(i=s.field.isKeyField()?Il.comparator(Il.fromName(o.referenceValue),n.key):rh(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function xh(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nh(e.position[n],t.position[n]))return!1;return!0}class Uh{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.lt=null,this.ft=null,this.startAt,this.endAt}}function Fh(e,t,n,i,r,s,o,a){return new Uh(e,t,n,i,r,s,o,a)}function Vh(e){return new Uh(e)}function jh(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Bh(e){for(const t of e.filters)if(t.ht())return t.field;return null}function qh(e){return null!==e.collectionGroup}function zh(e){const t=Zu(e);if(null===t.lt){t.lt=[];const e=Bh(t),n=jh(t);if(null!==e&&null===n)e.isKeyField()||t.lt.push(new Ph(e)),t.lt.push(new Ph(wl.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.lt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.lt.push(new Ph(wl.keyField(),e))}}}return t.lt}function Hh(e){const t=Zu(e);if(!t.ft)if("F"===t.limitType)t.ft=wh(t.path,t.collectionGroup,zh(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of zh(t)){const t="desc"===n.dir?"asc":"desc";e.push(new Ph(n.field,t))}const n=t.endAt?new Oh(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new Oh(t.startAt.position,t.startAt.inclusive):null;t.ft=wh(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}return t.ft}function $h(e,t,n){return new Uh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Kh(e,t){return bh(Hh(e),Hh(t))&&e.limitType===t.limitType}function Gh(e){return`${Ih(Hh(e))}|lt:${e.limitType}`}function Wh(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${oh(t.value)}`;var t})).join(", ")}]`),Yl(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>oh(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>oh(e))).join(",")),`Target(${t})`}(Hh(e))}; limitType=${e.limitType})`}function Qh(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Il.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=Mh(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,zh(e),t))&&!(e.endAt&&!function(e,t,n){const i=Mh(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,zh(e),t))}(e,t)}function Xh(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Yh(e){return(t,n)=>{let i=!1;for(const r of zh(e)){const e=Jh(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}function Jh(e,t,n){const i=e.field.isKeyField()?Il.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?rh(i,r):Yu()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return Yu()}}function Zh(e,t){if(e.dt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jl(t)?"-0":t}}function ed(e){return{integerValue:""+e}}function td(e,t){return Zl(t)?ed(t):Zh(e,t)}class nd{constructor(){this._=void 0}}function id(e,t,n){return e instanceof od?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof ad?cd(e,t):e instanceof ud?ld(e,t):function(e,t){const n=sd(e,t),i=dd(n)+dd(e._t);return ch(n)&&ch(e._t)?ed(i):Zh(e.wt,i)}(e,t)}function rd(e,t,n){return e instanceof ad?cd(e,t):e instanceof ud?ld(e,t):n}function sd(e,t){return e instanceof hd?ch(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class od extends nd{}class ad extends nd{constructor(e){super(),this.elements=e}}function cd(e,t){const n=fd(t);for(const t of e.elements)n.some((e=>nh(e,t)))||n.push(t);return{arrayValue:{values:n}}}class ud extends nd{constructor(e){super(),this.elements=e}}function ld(e,t){let n=fd(t);for(const t of e.elements)n=n.filter((e=>!nh(e,t)));return{arrayValue:{values:n}}}class hd extends nd{constructor(e,t){super(),this.wt=e,this._t=t}}function dd(e){return Hl(e.integerValue||e.doubleValue)}function fd(e){return uh(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class pd{constructor(e,t){this.version=e,this.transformResults=t}}class md{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new md}static exists(e){return new md(void 0,e)}static updateTime(e){return new md(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function gd(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class yd{}function vd(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Cd(e.key,md.none()):new Td(e.key,e.data,md.none());{const n=e.data,i=mh.empty();let r=new Fl(wl.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new Ed(e.key,i,new jl(r.toArray()),md.none())}}function wd(e,t,n){e instanceof Td?function(e,t,n){const i=e.value.clone(),r=Sd(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof Ed?function(e,t,n){if(!gd(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=Sd(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(kd(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Id(e,t,n,i){return e instanceof Td?function(e,t,n,i){if(!gd(e.precondition,t))return n;const r=e.value.clone(),s=Ad(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof Ed?function(e,t,n,i){if(!gd(e.precondition,t))return n;const r=Ad(e.fieldTransforms,i,t),s=t.data;return s.setAll(kd(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,i):function(e,t,n){return gd(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function bd(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),r=sd(i.transform,e||null);null!=r&&(null===n&&(n=mh.empty()),n.set(i.field,r))}return n||null}function _d(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&fl(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof ad&&t instanceof ad||e instanceof ud&&t instanceof ud?fl(e.elements,t.elements,nh):e instanceof hd&&t instanceof hd?nh(e._t,t._t):e instanceof od&&t instanceof od}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Td extends yd{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ed extends yd{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function kd(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}})),t}function Sd(e,t,n){const i=new Map;Ju(e.length===n.length);for(let r=0;r<n.length;r++){const s=e[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,rd(o,a,n[r]))}return i}function Ad(e,t,n){const i=new Map;for(const r of e){const e=r.transform,s=n.data.field(r.field);i.set(r.field,id(e,s,t))}return i}class Cd extends yd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Nd extends yd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Rd{constructor(e){this.count=e}}var Dd,Od;function Pd(e){switch(e){default:return Yu();case el.CANCELLED:case el.UNKNOWN:case el.DEADLINE_EXCEEDED:case el.RESOURCE_EXHAUSTED:case el.INTERNAL:case el.UNAVAILABLE:case el.UNAUTHENTICATED:return!1;case el.INVALID_ARGUMENT:case el.NOT_FOUND:case el.ALREADY_EXISTS:case el.PERMISSION_DENIED:case el.FAILED_PRECONDITION:case el.ABORTED:case el.OUT_OF_RANGE:case el.UNIMPLEMENTED:case el.DATA_LOSS:return!0}}function Ld(e){if(void 0===e)return Wu("GRPC error has no .code"),el.UNKNOWN;switch(e){case Dd.OK:return el.OK;case Dd.CANCELLED:return el.CANCELLED;case Dd.UNKNOWN:return el.UNKNOWN;case Dd.DEADLINE_EXCEEDED:return el.DEADLINE_EXCEEDED;case Dd.RESOURCE_EXHAUSTED:return el.RESOURCE_EXHAUSTED;case Dd.INTERNAL:return el.INTERNAL;case Dd.UNAVAILABLE:return el.UNAVAILABLE;case Dd.UNAUTHENTICATED:return el.UNAUTHENTICATED;case Dd.INVALID_ARGUMENT:return el.INVALID_ARGUMENT;case Dd.NOT_FOUND:return el.NOT_FOUND;case Dd.ALREADY_EXISTS:return el.ALREADY_EXISTS;case Dd.PERMISSION_DENIED:return el.PERMISSION_DENIED;case Dd.FAILED_PRECONDITION:return el.FAILED_PRECONDITION;case Dd.ABORTED:return el.ABORTED;case Dd.OUT_OF_RANGE:return el.OUT_OF_RANGE;case Dd.UNIMPLEMENTED:return el.UNIMPLEMENTED;case Dd.DATA_LOSS:return el.DATA_LOSS;default:return Yu()}}(Od=Dd||(Dd={}))[Od.OK=0]="OK",Od[Od.CANCELLED=1]="CANCELLED",Od[Od.UNKNOWN=2]="UNKNOWN",Od[Od.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Od[Od.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Od[Od.NOT_FOUND=5]="NOT_FOUND",Od[Od.ALREADY_EXISTS=6]="ALREADY_EXISTS",Od[Od.PERMISSION_DENIED=7]="PERMISSION_DENIED",Od[Od.UNAUTHENTICATED=16]="UNAUTHENTICATED",Od[Od.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Od[Od.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Od[Od.ABORTED=10]="ABORTED",Od[Od.OUT_OF_RANGE=11]="OUT_OF_RANGE",Od[Od.UNIMPLEMENTED=12]="UNIMPLEMENTED",Od[Od.INTERNAL=13]="INTERNAL",Od[Od.UNAVAILABLE=14]="UNAVAILABLE",Od[Od.DATA_LOSS=15]="DATA_LOSS";class Md{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,i]of n)if(this.equalsFn(t,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Pl(this.inner,((t,n)=>{for(const[t,i]of n)e(t,i)}))}isEmpty(){return Ll(this.inner)}size(){return this.innerSize}}const xd=new Ml(Il.comparator);function Ud(){return xd}const Fd=new Ml(Il.comparator);function Vd(...e){let t=Fd;for(const n of e)t=t.insert(n.key,n);return t}function jd(e){let t=Fd;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Bd(){return zd()}function qd(){return zd()}function zd(){return new Md((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Hd=new Ml(Il.comparator),$d=new Fl(Il.comparator);function Kd(...e){let t=$d;for(const n of e)t=t.add(n);return t}const Gd=new Fl(dl);function Wd(){return Gd}class Qd{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,Xd.createSynthesizedTargetChangeForCurrentChange(e,t)),new Qd(ml.min(),n,Wd(),Ud(),Kd())}}class Xd{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Xd(Bl.EMPTY_BYTE_STRING,t,Kd(),Kd(),Kd())}}class Yd{constructor(e,t,n,i){this.gt=e,this.removedTargetIds=t,this.key=n,this.yt=i}}class Jd{constructor(e,t){this.targetId=e,this.It=t}}class Zd{constructor(e,t,n=Bl.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class ef{constructor(){this.Tt=0,this.Et=rf(),this.At=Bl.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(e){e.approximateByteSize()>0&&(this.bt=!0,this.At=e)}St(){let e=Kd(),t=Kd(),n=Kd();return this.Et.forEach(((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Yu()}})),new Xd(this.At,this.Rt,e,t,n)}Dt(){this.bt=!1,this.Et=rf()}Ct(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}xt(e){this.bt=!0,this.Et=this.Et.remove(e)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Ot(){this.bt=!0,this.Rt=!0}}class tf{constructor(e){this.Mt=e,this.Ft=new Map,this.$t=Ud(),this.Bt=nf(),this.Lt=new Fl(dl)}Ut(e){for(const t of e.gt)e.yt&&e.yt.isFoundDocument()?this.qt(t,e.yt):this.Kt(t,e.key,e.yt);for(const t of e.removedTargetIds)this.Kt(t,e.key,e.yt)}Gt(e){this.forEachTarget(e,(t=>{const n=this.Qt(t);switch(e.state){case 0:this.jt(t)&&n.Vt(e.resumeToken);break;case 1:n.kt(),n.Pt||n.Dt(),n.Vt(e.resumeToken);break;case 2:n.kt(),n.Pt||this.removeTarget(t);break;case 3:this.jt(t)&&(n.Ot(),n.Vt(e.resumeToken));break;case 4:this.jt(t)&&(this.Wt(t),n.Vt(e.resumeToken));break;default:Yu()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ft.forEach(((e,n)=>{this.jt(n)&&t(n)}))}zt(e){const t=e.targetId,n=e.It.count,i=this.Ht(t);if(i){const e=i.target;if(_h(e))if(0===n){const n=new Il(e.path);this.Kt(t,n,yh.newNoDocument(n,ml.min()))}else Ju(1===n);else this.Jt(t)!==n&&(this.Wt(t),this.Lt=this.Lt.add(t))}}Yt(e){const t=new Map;this.Ft.forEach(((n,i)=>{const r=this.Ht(i);if(r){if(n.current&&_h(r.target)){const t=new Il(r.target.path);null!==this.$t.get(t)||this.Xt(i,t)||this.Kt(i,t,yh.newNoDocument(t,e))}n.vt&&(t.set(i,n.St()),n.Dt())}}));let n=Kd();this.Bt.forEach(((e,t)=>{let i=!0;t.forEachWhile((e=>{const t=this.Ht(e);return!t||2===t.purpose||(i=!1,!1)})),i&&(n=n.add(e))})),this.$t.forEach(((t,n)=>n.setReadTime(e)));const i=new Qd(e,t,this.Lt,this.$t,n);return this.$t=Ud(),this.Bt=nf(),this.Lt=new Fl(dl),i}qt(e,t){if(!this.jt(e))return;const n=this.Xt(e,t.key)?2:0;this.Qt(e).Ct(t.key,n),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e))}Kt(e,t,n){if(!this.jt(e))return;const i=this.Qt(e);this.Xt(e,t)?i.Ct(t,1):i.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),n&&(this.$t=this.$t.insert(t,n))}removeTarget(e){this.Ft.delete(e)}Jt(e){const t=this.Qt(e).St();return this.Mt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Nt(e){this.Qt(e).Nt()}Qt(e){let t=this.Ft.get(e);return t||(t=new ef,this.Ft.set(e,t)),t}Zt(e){let t=this.Bt.get(e);return t||(t=new Fl(dl),this.Bt=this.Bt.insert(e,t)),t}jt(e){const t=null!==this.Ht(e);return t||Gu("WatchChangeAggregator","Detected inactive target",e),t}Ht(e){const t=this.Ft.get(e);return t&&t.Pt?null:this.Mt.te(e)}Wt(e){this.Ft.set(e,new ef),this.Mt.getRemoteKeysForTarget(e).forEach((t=>{this.Kt(e,t,null)}))}Xt(e,t){return this.Mt.getRemoteKeysForTarget(e).has(t)}}function nf(){return new Ml(Il.comparator)}function rf(){return new Ml(Il.comparator)}const sf={asc:"ASCENDING",desc:"DESCENDING"},of={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class af{constructor(e,t){this.databaseId=e,this.dt=t}}function cf(e,t){return e.dt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function uf(e,t){return e.dt?t.toBase64():t.toUint8Array()}function lf(e,t){return cf(e,t.toTimestamp())}function hf(e){return Ju(!!e),ml.fromTimestamp(function(e){const t=zl(e);return new pl(t.seconds,t.nanos)}(e))}function df(e,t){return function(e){return new yl(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function ff(e){const t=yl.fromString(e);return Ju(Pf(t)),t}function pf(e,t){return df(e.databaseId,t.path)}function mf(e,t){const n=ff(t);if(n.get(1)!==e.databaseId.projectId)throw new tl(el.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new tl(el.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Il(wf(n))}function gf(e,t){return df(e.databaseId,t)}function yf(e){const t=ff(e);return 4===t.length?yl.emptyPath():wf(t)}function vf(e){return new yl(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function wf(e){return Ju(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function If(e,t,n){return{name:pf(e,t),fields:n.value.mapValue.fields}}function bf(e,t){let n;if(t instanceof Td)n={update:If(e,t.key,t.value)};else if(t instanceof Cd)n={delete:pf(e,t.key)};else if(t instanceof Ed)n={update:If(e,t.key,t.data),updateMask:Of(t.fieldMask)};else{if(!(t instanceof Nd))return Yu();n={verify:pf(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof od)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ad)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ud)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof hd)return{fieldPath:t.field.canonicalString(),increment:n._t};throw Yu()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:lf(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Yu()}(e,t.precondition)),n}function _f(e,t){return{documents:[gf(e,t.path)]}}function Tf(e,t){const n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n.parent=gf(e,i),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=gf(e,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(hh(e.value))return{unaryFilter:{field:Cf(e.field),op:"IS_NAN"}};if(lh(e.value))return{unaryFilter:{field:Cf(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(hh(e.value))return{unaryFilter:{field:Cf(e.field),op:"IS_NOT_NAN"}};if(lh(e.value))return{unaryFilter:{field:Cf(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Cf(e.field),op:Af(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);r&&(n.structuredQuery.where=r);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Cf(e.field),direction:Sf(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.dt||Yl(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Ef(e){let t=yf(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){Ju(1===i);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=kf(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Ph(Nf(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Yl(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Oh(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Oh(n,t)}(n.endAt)),Fh(t,r,o,s,a,"F",c,u)}function kf(e){return e?void 0!==e.unaryFilter?[Df(e)]:void 0!==e.fieldFilter?[Rf(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>kf(e))).reduce(((e,t)=>e.concat(t))):Yu():[]}function Sf(e){return sf[e]}function Af(e){return of[e]}function Cf(e){return{fieldPath:e.canonicalString()}}function Nf(e){return wl.fromServerFormat(e.fieldPath)}function Rf(e){return Th.create(Nf(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Yu()}}(e.fieldFilter.op),e.fieldFilter.value)}function Df(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Nf(e.unaryFilter.field);return Th.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Nf(e.unaryFilter.field);return Th.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Nf(e.unaryFilter.field);return Th.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Nf(e.unaryFilter.field);return Th.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Yu()}}function Of(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Pf(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}const Lf=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Mf=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],xf=Mf;class Uf{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const i=this.mutations[t];i.key.isEqual(e.key)&&wd(i,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Id(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Id(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=qd();return this.mutations.forEach((i=>{const r=e.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=t.has(i.key)?null:o;const a=vd(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(ml.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Kd())}isEqual(e){return this.batchId===e.batchId&&fl(this.mutations,e.mutations,((e,t)=>_d(e,t)))&&fl(this.baseMutations,e.baseMutations,((e,t)=>_d(e,t)))}}class Ff{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Ju(e.mutations.length===n.length);let i=Hd;const r=e.mutations;for(let e=0;e<r.length;e++)i=i.insert(r[e].key,n[e].version);return new Ff(e,t,n,i)}}class Vf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class jf{constructor(e,t,n,i,r=ml.min(),s=ml.min(),o=Bl.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new jf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new jf(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new jf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Bf{constructor(e){this.ne=e}}function qf(e){const t=Ef({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?$h(t,t.limit,"L"):t}class zf{constructor(){}re(e,t){this.oe(e,t),t.ue()}oe(e,t){if("nullValue"in e)this.ce(t,5);else if("booleanValue"in e)this.ce(t,10),t.ae(e.booleanValue?1:0);else if("integerValue"in e)this.ce(t,15),t.ae(Hl(e.integerValue));else if("doubleValue"in e){const n=Hl(e.doubleValue);isNaN(n)?this.ce(t,13):(this.ce(t,15),Jl(n)?t.ae(0):t.ae(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ce(t,20),"string"==typeof n?t.he(n):(t.he(`${n.seconds||""}`),t.ae(n.nanos||0))}else if("stringValue"in e)this.le(e.stringValue,t),this.fe(t);else if("bytesValue"in e)this.ce(t,30),t.de($l(e.bytesValue)),this.fe(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ce(t,45),t.ae(n.latitude||0),t.ae(n.longitude||0)}else"mapValue"in e?ph(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):Yu()}le(e,t){this.ce(t,25),this.ge(e,t)}ge(e,t){t.he(e)}we(e,t){const n=e.fields||{};this.ce(t,55);for(const e of Object.keys(n))this.le(e,t),this.oe(n[e],t)}me(e,t){const n=e.values||[];this.ce(t,50);for(const e of n)this.oe(e,t)}_e(e,t){this.ce(t,37),Il.fromName(e).path.forEach((e=>{this.ce(t,60),this.ge(e,t)}))}ce(e,t){e.ae(t)}fe(e){e.ae(2)}}zf.ye=new zf;class Hf{constructor(){this.ze=new $f}addToCollectionParentIndex(e,t){return this.ze.add(t),Nl.resolve()}getCollectionParents(e,t){return Nl.resolve(this.ze.getEntries(t))}addFieldIndex(e,t){return Nl.resolve()}deleteFieldIndex(e,t){return Nl.resolve()}getDocumentsMatchingTarget(e,t){return Nl.resolve(null)}getIndexType(e,t){return Nl.resolve(0)}getFieldIndexes(e,t){return Nl.resolve([])}getNextCollectionGroupToUpdate(e){return Nl.resolve(null)}getMinOffset(e,t){return Nl.resolve(El.min())}getMinOffsetFromCollectionGroup(e,t){return Nl.resolve(El.min())}updateCollectionGroup(e,t,n){return Nl.resolve()}updateIndexEntries(e,t){return Nl.resolve()}}class $f{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Fl(yl.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Fl(yl.comparator)).toArray()}}new Uint8Array(0);class Kf{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Kf(e,Kf.DEFAULT_COLLECTION_PERCENTILE,Kf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Kf.DEFAULT_COLLECTION_PERCENTILE=10,Kf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Kf.DEFAULT=new Kf(41943040,Kf.DEFAULT_COLLECTION_PERCENTILE,Kf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Kf.DISABLED=new Kf(-1,0,0);class Gf{constructor(e){this.En=e}next(){return this.En+=2,this.En}static An(){return new Gf(0)}static Rn(){return new Gf(-1)}}class Wf{constructor(){this.changes=new Md((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yh.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Nl.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Qf{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Xf{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.getBaseDocument(e,t,n)))).next((e=>(null!==n&&Id(n.mutation,e,jl.empty(),pl.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Kd()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Kd()){const i=Bd();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((e=>{let t=Vd();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Bd();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Kd())))}populateOverlays(e,t,n){const i=[];return n.forEach((e=>{t.has(e)||i.push(e)})),this.documentOverlayCache.getOverlays(e,i).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,i){let r=Ud();const s=zd(),o=zd();return t.forEach(((e,t)=>{const o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof Ed)?r=r.insert(t.key,t):void 0!==o&&(s.set(t.key,o.mutation.getFieldMask()),Id(o.mutation,t,o.mutation.getFieldMask(),pl.now()))})),this.recalculateAndSaveOverlays(e,r).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Qf(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=zd();let i=new Ml(((e,t)=>e-t)),r=Kd();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const r of e)r.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||jl.empty();o=r.applyToLocalView(s,o),n.set(e,o);const a=(i.get(r.batchId)||Kd()).add(e);i=i.insert(r.batchId,a)}))})).next((()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,u=qd();c.forEach((e=>{if(!r.has(e)){const i=vd(t.get(e),n.get(e));null!==i&&u.set(e,i),r=r.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Nl.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return Il.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):qh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):Nl.resolve(Bd());let o=-1,a=r;return s.next((t=>Nl.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?Nl.resolve():this.getBaseDocument(e,t,n).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,r))).next((()=>this.computeViews(e,a,t,Kd()))).next((e=>({batchId:o,changes:jd(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Il(t)).next((e=>{let t=Vd();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const i=t.collectionGroup;let r=Vd();return this.indexManager.getCollectionParents(e,i).next((s=>Nl.forEach(s,(s=>{const o=function(e,t){return new Uh(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,n){let i;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next((r=>(i=r,this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId)))).next((e=>{e.forEach(((e,t)=>{const n=t.getKey();null===i.get(n)&&(i=i.insert(n,yh.newInvalidDocument(n)))}));let n=Vd();return i.forEach(((i,r)=>{const s=e.get(i);void 0!==s&&Id(s.mutation,r,jl.empty(),pl.now()),Qh(t,r)&&(n=n.insert(i,r))})),n}))}getBaseDocument(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):Nl.resolve(yh.newInvalidDocument(t))}}class Yf{constructor(e){this.wt=e,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(e,t){return Nl.resolve(this.Jn.get(t))}saveBundleMetadata(e,t){var n;return this.Jn.set(t.id,{id:(n=t).id,version:n.version,createTime:hf(n.createTime)}),Nl.resolve()}getNamedQuery(e,t){return Nl.resolve(this.Yn.get(t))}saveNamedQuery(e,t){return this.Yn.set(t.name,function(e){return{name:e.name,query:qf(e.bundledQuery),readTime:hf(e.readTime)}}(t)),Nl.resolve()}}class Jf{constructor(){this.overlays=new Ml(Il.comparator),this.Xn=new Map}getOverlay(e,t){return Nl.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Bd();return Nl.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,i)=>{this.ie(e,t,i)})),Nl.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Xn.get(n);return void 0!==i&&(i.forEach((e=>this.overlays=this.overlays.remove(e))),this.Xn.delete(n)),Nl.resolve()}getOverlaysForCollection(e,t,n){const i=Bd(),r=t.length+1,s=new Il(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return Nl.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new Ml(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=Bd(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Bd(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=i)););return Nl.resolve(o)}ie(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.Xn.get(i.largestBatchId).delete(n.key);this.Xn.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Vf(t,n));let r=this.Xn.get(t);void 0===r&&(r=Kd(),this.Xn.set(t,r)),this.Xn.set(t,r.add(n.key))}}class Zf{constructor(){this.Zn=new Fl(ep.ts),this.es=new Fl(ep.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){const n=new ep(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.rs(new ep(e,t))}os(e,t){e.forEach((e=>this.removeReference(e,t)))}us(e){const t=new Il(new yl([])),n=new ep(t,e),i=new ep(t,e+1),r=[];return this.es.forEachInRange([n,i],(e=>{this.rs(e),r.push(e.key)})),r}cs(){this.Zn.forEach((e=>this.rs(e)))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const t=new Il(new yl([])),n=new ep(t,e),i=new ep(t,e+1);let r=Kd();return this.es.forEachInRange([n,i],(e=>{r=r.add(e.key)})),r}containsKey(e){const t=new ep(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ep{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return Il.comparator(e.key,t.key)||dl(e.ls,t.ls)}static ns(e,t){return dl(e.ls,t.ls)||Il.comparator(e.key,t.key)}}class tp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.fs=1,this.ds=new Fl(ep.ts)}checkEmpty(e){return Nl.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const r=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Uf(r,t,n,i);this.mutationQueue.push(s);for(const t of i)this.ds=this.ds.add(new ep(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Nl.resolve(s)}lookupMutationBatch(e,t){return Nl.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ws(n),r=i<0?0:i;return Nl.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return Nl.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(e){return Nl.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ep(t,0),i=new ep(t,Number.POSITIVE_INFINITY),r=[];return this.ds.forEachInRange([n,i],(e=>{const t=this._s(e.ls);r.push(t)})),Nl.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Fl(dl);return t.forEach((e=>{const t=new ep(e,0),i=new ep(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,i],(e=>{n=n.add(e.ls)}))})),Nl.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let r=n;Il.isDocumentKey(r)||(r=r.child(""));const s=new ep(new Il(r),0);let o=new Fl(dl);return this.ds.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.ls)),!0)}),s),Nl.resolve(this.gs(o))}gs(e){const t=[];return e.forEach((e=>{const n=this._s(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Ju(0===this.ys(t.batchId,"removed")),this.mutationQueue.shift();let n=this.ds;return Nl.forEach(t.mutations,(i=>{const r=new ep(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.ds=n}))}In(e){}containsKey(e,t){const n=new ep(t,0),i=this.ds.firstAfterOrEqual(n);return Nl.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Nl.resolve()}ys(e,t){return this.ws(e)}ws(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}_s(e){const t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class np{constructor(e){this.ps=e,this.docs=new Ml(Il.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.ps(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Nl.resolve(n?n.document.mutableCopy():yh.newInvalidDocument(t))}getEntries(e,t){let n=Ud();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():yh.newInvalidDocument(e))})),Nl.resolve(n)}getAllFromCollection(e,t,n){let i=Ud();const r=new Il(t.child("")),s=this.docs.getIteratorFrom(r);for(;s.hasNext();){const{key:e,value:{document:r}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||kl(Tl(r),n)<=0||(i=i.insert(r.key,r.mutableCopy()))}return Nl.resolve(i)}getAllFromCollectionGroup(e,t,n,i){Yu()}Is(e,t){return Nl.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new ip(this)}getSize(e){return Nl.resolve(this.size)}}class ip extends Wf{constructor(e){super(),this.zn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.zn.addEntry(e,i)):this.zn.removeEntry(n)})),Nl.waitFor(t)}getFromCache(e,t){return this.zn.getEntry(e,t)}getAllFromCache(e,t){return this.zn.getEntries(e,t)}}class rp{constructor(e){this.persistence=e,this.Ts=new Md((e=>Ih(e)),bh),this.lastRemoteSnapshotVersion=ml.min(),this.highestTargetId=0,this.Es=0,this.As=new Zf,this.targetCount=0,this.Rs=Gf.An()}forEachTarget(e,t){return this.Ts.forEach(((e,n)=>t(n))),Nl.resolve()}getLastRemoteSnapshotVersion(e){return Nl.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Nl.resolve(this.Es)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),Nl.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Es&&(this.Es=t),Nl.resolve()}vn(e){this.Ts.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Rs=new Gf(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}addTargetData(e,t){return this.vn(t),this.targetCount+=1,Nl.resolve()}updateTargetData(e,t){return this.vn(t),Nl.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),this.targetCount-=1,Nl.resolve()}removeTargets(e,t,n){let i=0;const r=[];return this.Ts.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Ts.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Nl.waitFor(r).next((()=>i))}getTargetCount(e){return Nl.resolve(this.targetCount)}getTargetData(e,t){const n=this.Ts.get(t)||null;return Nl.resolve(n)}addMatchingKeys(e,t,n){return this.As.ss(t,n),Nl.resolve()}removeMatchingKeys(e,t,n){this.As.os(t,n);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach((t=>{r.push(i.markPotentiallyOrphaned(e,t))})),Nl.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.As.us(t),Nl.resolve()}getMatchingKeysForTargetId(e,t){const n=this.As.hs(t);return Nl.resolve(n)}containsKey(e,t){return Nl.resolve(this.As.containsKey(t))}}class sp{constructor(e,t){this.bs={},this.overlays={},this.Ps=new Dl(0),this.vs=!1,this.vs=!0,this.referenceDelegate=e(this),this.Vs=new rp(this),this.indexManager=new Hf,this.remoteDocumentCache=function(e){return new np(e)}((e=>this.referenceDelegate.Ss(e))),this.wt=new Bf(t),this.Ds=new Yf(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Jf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.bs[e.toKey()];return n||(n=new tp(t,this.referenceDelegate),this.bs[e.toKey()]=n),n}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(e,t,n){Gu("MemoryPersistence","Starting transaction:",e);const i=new op(this.Ps.next());return this.referenceDelegate.Cs(),n(i).next((e=>this.referenceDelegate.xs(i).next((()=>e)))).toPromise().then((e=>(i.raiseOnCommittedEvent(),e)))}Ns(e,t){return Nl.or(Object.values(this.bs).map((n=>()=>n.containsKey(e,t))))}}class op extends Al{constructor(e){super(),this.currentSequenceNumber=e}}class ap{constructor(e){this.persistence=e,this.ks=new Zf,this.Os=null}static Ms(e){return new ap(e)}get Fs(){if(this.Os)return this.Os;throw Yu()}addReference(e,t,n){return this.ks.addReference(n,t),this.Fs.delete(n.toString()),Nl.resolve()}removeReference(e,t,n){return this.ks.removeReference(n,t),this.Fs.add(n.toString()),Nl.resolve()}markPotentiallyOrphaned(e,t){return this.Fs.add(t.toString()),Nl.resolve()}removeTarget(e,t){this.ks.us(t.targetId).forEach((e=>this.Fs.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Fs.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Cs(){this.Os=new Set}xs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Nl.forEach(this.Fs,(n=>{const i=Il.fromPath(n);return this.$s(e,i).next((e=>{e||t.removeEntry(i,ml.min())}))})).next((()=>(this.Os=null,t.apply(e))))}updateLimboDocument(e,t){return this.$s(e,t).next((e=>{e?this.Fs.delete(t.toString()):this.Fs.add(t.toString())}))}Ss(e){return 0}$s(e,t){return Nl.or([()=>Nl.resolve(this.ks.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ns(e,t)])}}class cp{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Pi=n,this.vi=i}static Vi(e,t){let n=Kd(),i=Kd();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new cp(e,t.fromCache,n,i)}}class up{constructor(){this.Si=!1}initialize(e,t){this.Di=e,this.indexManager=t,this.Si=!0}getDocumentsMatchingQuery(e,t,n,i){return this.Ci(e,t).next((r=>r||this.xi(e,t,i,n))).next((n=>n||this.Ni(e,t)))}Ci(e,t){return Nl.resolve(null)}xi(e,t,n,i){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||i.isEqual(ml.min())?this.Ni(e,t):this.Di.getDocuments(e,n).next((r=>{const s=this.ki(t,r);return this.Oi(t,s,n,i)?this.Ni(e,t):(Ku()<=P.DEBUG&&Gu("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Wh(t)),this.Mi(e,s,t,_l(i,-1)))}))}ki(e,t){let n=new Fl(Yh(e));return t.forEach(((t,i)=>{Qh(e,i)&&(n=n.add(i))})),n}Oi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Ni(e,t){return Ku()<=P.DEBUG&&Gu("QueryEngine","Using full collection scan to execute query:",Wh(t)),this.Di.getDocumentsMatchingQuery(e,t,El.min())}Mi(e,t,n,i){return this.Di.getDocumentsMatchingQuery(e,n,i).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class lp{constructor(e,t,n,i){this.persistence=e,this.Fi=t,this.wt=i,this.$i=new Ml(dl),this.Bi=new Md((e=>Ih(e)),bh),this.Li=new Map,this.Ui=e.getRemoteDocumentCache(),this.Vs=e.getTargetCache(),this.Ds=e.getBundleCache(),this.qi(n)}qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Xf(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.$i)))}}function hp(e,t,n,i){return new lp(e,t,n,i)}async function dp(e,t){const n=Zu(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next((r=>(i=r,n.qi(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const r=[],s=[];let o=Kd();for(const e of i){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Ki:e,removedBatchIds:r,addedBatchIds:s})))}))}))}function fp(e){const t=Zu(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Vs.getLastRemoteSnapshotVersion(e)))}function pp(e,t,n){let i=Kd(),r=Kd();return n.forEach((e=>i=i.add(e))),t.getEntries(e,i).next((e=>{let i=Ud();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(ml.min())?(t.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),i=i.insert(n,s)):Gu("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{Gi:i,Qi:r}}))}function mp(e,t){const n=Zu(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function gp(e,t){const n=Zu(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let i;return n.Vs.getTargetData(e,t).next((r=>r?(i=r,Nl.resolve(i)):n.Vs.allocateTargetId(e).next((r=>(i=new jf(t,r,0,e.currentSequenceNumber),n.Vs.addTargetData(e,i).next((()=>i)))))))})).then((e=>{const i=n.$i.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.$i=n.$i.insert(e.targetId,e),n.Bi.set(t,e.targetId)),e}))}async function yp(e,t,n){const i=Zu(e),r=i.$i.get(t),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,(e=>i.persistence.referenceDelegate.removeTarget(e,r)))}catch(e){if(!Rl(e))throw e;Gu("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}i.$i=i.$i.remove(t),i.Bi.delete(r.target)}function vp(e,t,n){const i=Zu(e);let r=ml.min(),s=Kd();return i.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const i=Zu(e),r=i.Bi.get(n);return void 0!==r?Nl.resolve(i.$i.get(r)):i.Vs.getTargetData(t,n)}(i,e,Hh(t)).next((t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,i.Vs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>i.Fi.getDocumentsMatchingQuery(e,t,n?r:ml.min(),n?s:Kd()))).next((e=>(wp(i,Xh(t),e),{documents:e,ji:s})))))}function wp(e,t,n){let i=ml.min();n.forEach(((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)})),e.Li.set(t,i)}class Ip{constructor(){this.activeTargetIds=Wd()}Xi(e){this.activeTargetIds=this.activeTargetIds.add(e)}Zi(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Yi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bp{constructor(){this.Fr=new Ip,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}updateQueryState(e,t,n){this.$r[e]=t}removeLocalQueryTarget(e){this.Fr.Zi(e)}isLocalQueryTarget(e){return this.Fr.activeTargetIds.has(e)}clearQueryState(e){delete this.$r[e]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(e){return this.Fr.activeTargetIds.has(e)}start(){return this.Fr=new Ip,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class _p{Br(e){}shutdown(){}}class Tp{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(e){this.Gr.push(e)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){Gu("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Gr)e(0)}Kr(){Gu("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Gr)e(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Ep={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class kp{constructor(e){this.jr=e.jr,this.Wr=e.Wr}zr(e){this.Hr=e}Jr(e){this.Yr=e}onMessage(e){this.Xr=e}close(){this.Wr()}send(e){this.jr(e)}Zr(){this.Hr()}eo(e){this.Yr(e)}no(e){this.Xr(e)}}class Sp extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.so=t+"://"+e.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(e,t,n,i,r){const s=this.oo(e,t);Gu("RestConnection","Sending: ",s,n);const o={};return this.uo(o,i,r),this.co(e,s,o,n).then((e=>(Gu("RestConnection","Received: ",e),e)),(t=>{throw Qu("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}ao(e,t,n,i,r,s){return this.ro(e,t,n,i,r)}uo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Hu,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}oo(e,t){const n=Ep[e];return`${this.so}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(e,t,n,i){return new Promise(((r,s)=>{const o=new Bu;o.listenOnce(xu.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Mu.NO_ERROR:const t=o.getResponseJson();Gu("Connection","XHR received:",JSON.stringify(t)),r(t);break;case Mu.TIMEOUT:Gu("Connection",'RPC "'+e+'" timed out'),s(new tl(el.DEADLINE_EXCEEDED,"Request time out"));break;case Mu.HTTP_ERROR:const n=o.getStatus();if(Gu("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(el).indexOf(t)>=0?t:el.UNKNOWN}(e.status);s(new tl(t,e.message))}else s(new tl(el.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new tl(el.UNAVAILABLE,"Connection failed."));break;default:Yu()}}finally{Gu("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(i);o.send(t,"POST",a,n,15)}))}ho(e,t,n){const i=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=Pu(),s=Lu(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Vu({})),this.uo(o.initMessageHeaders,t,n),u()||d()||c().indexOf("Electron/")>=0||f()||c().indexOf("MSAppHost/")>=0||h()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=i.join("");Gu("Connection","Creating WebChannel: "+a,o);const l=r.createWebChannel(a,o);let p=!1,m=!1;const g=new kp({jr:e=>{m?Gu("Connection","Not sending because WebChannel is closed:",e):(p||(Gu("Connection","Opening WebChannel transport."),l.open(),p=!0),Gu("Connection","WebChannel sending:",e),l.send(e))},Wr:()=>l.close()}),y=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return y(l,ju.EventType.OPEN,(()=>{m||Gu("Connection","WebChannel transport opened.")})),y(l,ju.EventType.CLOSE,(()=>{m||(m=!0,Gu("Connection","WebChannel transport closed"),g.eo())})),y(l,ju.EventType.ERROR,(e=>{m||(m=!0,Qu("Connection","WebChannel transport errored:",e),g.eo(new tl(el.UNAVAILABLE,"The operation could not be completed")))})),y(l,ju.EventType.MESSAGE,(e=>{var t;if(!m){const n=e.data[0];Ju(!!n);const i=n,r=i.error||(null===(t=i[0])||void 0===t?void 0:t.error);if(r){Gu("Connection","WebChannel received error:",r);const e=r.status;let t=function(e){const t=Dd[e];if(void 0!==t)return Ld(t)}(e),n=r.message;void 0===t&&(t=el.INTERNAL,n="Unknown error status: "+e+" with message "+r.message),m=!0,g.eo(new tl(t,n)),l.close()}else Gu("Connection","WebChannel received:",n),g.no(n)}})),y(s,Uu.STAT_EVENT,(e=>{e.stat===Fu.PROXY?Gu("Connection","Detected buffering proxy"):e.stat===Fu.NOPROXY&&Gu("Connection","Detected no buffering proxy")})),setTimeout((()=>{g.Zr()}),0),g}}function Ap(){return"undefined"!=typeof document?document:null}function Cp(e){return new af(e,!0)}class Np{constructor(e,t,n=1e3,i=1.5,r=6e4){this.js=e,this.timerId=t,this.lo=n,this.fo=i,this._o=r,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(e){this.cancel();const t=Math.floor(this.wo+this.To()),n=Math.max(0,Date.now()-this.yo),i=Math.max(0,t-n);i>0&&Gu("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.wo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,i,(()=>(this.yo=Date.now(),e()))),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class Rp{constructor(e,t,n,i,r,s,o,a){this.js=e,this.Ao=n,this.Ro=i,this.bo=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new Np(e,t)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}async stop(){this.Do()&&await this.close(0)}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,(()=>this.Oo())))}Mo(e){this.Fo(),this.stream.send(e)}async Oo(){if(this.Co())return this.close(0)}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}async close(e,t){this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==e?this.So.reset():t&&t.code===el.RESOURCE_EXHAUSTED?(Wu(t.toString()),Wu("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):t&&t.code===el.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Jr(t)}Bo(){}auth(){this.state=1;const e=this.Lo(this.Po),t=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Po===t&&this.Uo(e,n)}),(t=>{e((()=>{const e=new tl(el.UNKNOWN,"Fetching auth token failed: "+t.message);return this.qo(e)}))}))}Uo(e,t){const n=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr((()=>{n((()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,(()=>(this.Co()&&(this.state=3),Promise.resolve()))),this.listener.zr())))})),this.stream.Jr((e=>{n((()=>this.qo(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}xo(){this.state=5,this.So.Io((async()=>{this.state=0,this.start()}))}qo(e){return Gu("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Lo(e){return t=>{this.js.enqueueAndForget((()=>this.Po===e?t():(Gu("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Dp extends Rp{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.wt=r}Ko(e,t){return this.bo.ho("Listen",e,t)}onMessage(e){this.So.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Yu()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(e,t){return e.dt?(Ju(void 0===t||"string"==typeof t),Bl.fromBase64String(t||"")):(Ju(void 0===t||t instanceof Uint8Array),Bl.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?el.UNKNOWN:Ld(e.code);return new tl(t,e.message||"")}(o);n=new Zd(i,r,s,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const r=mf(e,i.document.name),s=hf(i.document.updateTime),o=new mh({mapValue:{fields:i.document.fields}}),a=yh.newFoundDocument(r,s,o),c=i.targetIds||[],u=i.removedTargetIds||[];n=new Yd(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const r=mf(e,i.document),s=i.readTime?hf(i.readTime):ml.min(),o=yh.newNoDocument(r,s),a=i.removedTargetIds||[];n=new Yd([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const r=mf(e,i.document),s=i.removedTargetIds||[];n=new Yd([],s,r,null)}else{if(!("filter"in t))return Yu();{t.filter;const e=t.filter;e.targetId;const i=e.count||0,r=new Rd(i),s=e.targetId;n=new Jd(s,r)}}return n}(this.wt,e),n=function(e){if(!("targetChange"in e))return ml.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ml.min():t.readTime?hf(t.readTime):ml.min()}(e);return this.listener.Go(t,n)}Qo(e){const t={};t.database=vf(this.wt),t.addTarget=function(e,t){let n;const i=t.target;return n=_h(i)?{documents:_f(e,i)}:{query:Tf(e,i)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=uf(e,t.resumeToken):t.snapshotVersion.compareTo(ml.min())>0&&(n.readTime=cf(e,t.snapshotVersion.toTimestamp())),n}(this.wt,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Yu()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.wt,e);n&&(t.labels=n),this.Mo(t)}jo(e){const t={};t.database=vf(this.wt),t.removeTarget=e,this.Mo(t)}}class Op extends Rp{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.wt=r,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(e,t){return this.bo.ho("Write",e,t)}onMessage(e){if(Ju(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();const t=function(e,t){return e&&e.length>0?(Ju(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?hf(e.updateTime):hf(t);return n.isEqual(ml.min())&&(n=hf(t)),new pd(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=hf(e.commitTime);return this.listener.Jo(n,t)}return Ju(!e.writeResults||0===e.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const e={};e.database=vf(this.wt),this.Mo(e)}Ho(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>bf(this.wt,e)))};this.Mo(t)}}class Pp extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.bo=n,this.wt=i,this.Zo=!1}tu(){if(this.Zo)throw new tl(el.FAILED_PRECONDITION,"The client has already been terminated.")}ro(e,t,n){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.bo.ro(e,t,n,i,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===el.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tl(el.UNKNOWN,e.toString())}))}ao(e,t,n,i){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.bo.ao(e,t,n,r,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===el.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tl(el.UNKNOWN,e.toString())}))}terminate(){this.Zo=!0}}class Lp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve()))))}uu(e){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ru("Offline")))}set(e){this.cu(),this.eu=0,"Online"===e&&(this.su=!1),this.ru(e)}ru(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ou(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(Wu(t),this.su=!1):Gu("OnlineStateTracker",t)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class Mp{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=r,this.du.Br((e=>{n.enqueueAndForget((async()=>{Hp(this)&&(Gu("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Zu(e);t.lu.add(4),await Up(t),t._u.set("Unknown"),t.lu.delete(4),await xp(t)}(this))}))})),this._u=new Lp(n,i)}}async function xp(e){if(Hp(e))for(const t of e.fu)await t(!0)}async function Up(e){for(const t of e.fu)await t(!1)}function Fp(e,t){const n=Zu(e);n.hu.has(t.targetId)||(n.hu.set(t.targetId,t),zp(n)?qp(n):cm(n).Co()&&jp(n,t))}function Vp(e,t){const n=Zu(e),i=cm(n);n.hu.delete(t),i.Co()&&Bp(n,t),0===n.hu.size&&(i.Co()?i.ko():Hp(n)&&n._u.set("Unknown"))}function jp(e,t){e.wu.Nt(t.targetId),cm(e).Qo(t)}function Bp(e,t){e.wu.Nt(t),cm(e).jo(t)}function qp(e){e.wu=new tf({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),te:t=>e.hu.get(t)||null}),cm(e).start(),e._u.iu()}function zp(e){return Hp(e)&&!cm(e).Do()&&e.hu.size>0}function Hp(e){return 0===Zu(e).lu.size}function $p(e){e.wu=void 0}async function Kp(e){e.hu.forEach(((t,n)=>{jp(e,t)}))}async function Gp(e,t){$p(e),zp(e)?(e._u.uu(t),qp(e)):e._u.set("Unknown")}async function Wp(e,t,n){if(e._u.set("Online"),t instanceof Zd&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.hu.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.hu.delete(i),e.wu.removeTarget(i))}(e,t)}catch(n){Gu("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Qp(e,n)}else if(t instanceof Yd?e.wu.Ut(t):t instanceof Jd?e.wu.zt(t):e.wu.Gt(t),!n.isEqual(ml.min()))try{const t=await fp(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.wu.Yt(t);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.hu.get(i);r&&e.hu.set(i,r.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.hu.get(t);if(!n)return;e.hu.set(t,n.withResumeToken(Bl.EMPTY_BYTE_STRING,n.snapshotVersion)),Bp(e,t);const i=new jf(n.target,t,1,n.sequenceNumber);jp(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Gu("RemoteStore","Failed to raise snapshot:",t),await Qp(e,t)}}async function Qp(e,t,n){if(!Rl(t))throw t;e.lu.add(1),await Up(e),e._u.set("Offline"),n||(n=()=>fp(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Gu("RemoteStore","Retrying IndexedDB access"),await n(),e.lu.delete(1),await xp(e)}))}function Xp(e,t){return t().catch((n=>Qp(e,n,t)))}async function Yp(e){const t=Zu(e),n=um(t);let i=t.au.length>0?t.au[t.au.length-1].batchId:-1;for(;Jp(t);)try{const e=await mp(t.localStore,i);if(null===e){0===t.au.length&&n.ko();break}i=e.batchId,Zp(t,e)}catch(e){await Qp(t,e)}em(t)&&tm(t)}function Jp(e){return Hp(e)&&e.au.length<10}function Zp(e,t){e.au.push(t);const n=um(e);n.Co()&&n.zo&&n.Ho(t.mutations)}function em(e){return Hp(e)&&!um(e).Do()&&e.au.length>0}function tm(e){um(e).start()}async function nm(e){um(e).Xo()}async function im(e){const t=um(e);for(const n of e.au)t.Ho(n.mutations)}async function rm(e,t,n){const i=e.au.shift(),r=Ff.from(i,t,n);await Xp(e,(()=>e.remoteSyncer.applySuccessfulWrite(r))),await Yp(e)}async function sm(e,t){t&&um(e).zo&&await async function(e,t){if(Pd(n=t.code)&&n!==el.ABORTED){const n=e.au.shift();um(e).No(),await Xp(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Yp(e)}var n}(e,t),em(e)&&tm(e)}async function om(e,t){const n=Zu(e);n.asyncQueue.verifyOperationInProgress(),Gu("RemoteStore","RemoteStore received new credentials");const i=Hp(n);n.lu.add(3),await Up(n),i&&n._u.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.lu.delete(3),await xp(n)}async function am(e,t){const n=Zu(e);t?(n.lu.delete(2),await xp(n)):t||(n.lu.add(2),await Up(n),n._u.set("Unknown"))}function cm(e){return e.mu||(e.mu=function(e,t,n){const i=Zu(e);return i.tu(),new Dp(t,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,n)}(e.datastore,e.asyncQueue,{zr:Kp.bind(null,e),Jr:Gp.bind(null,e),Go:Wp.bind(null,e)}),e.fu.push((async t=>{t?(e.mu.No(),zp(e)?qp(e):e._u.set("Unknown")):(await e.mu.stop(),$p(e))}))),e.mu}function um(e){return e.gu||(e.gu=function(e,t,n){const i=Zu(e);return i.tu(),new Op(t,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,n)}(e.datastore,e.asyncQueue,{zr:nm.bind(null,e),Jr:sm.bind(null,e),Yo:im.bind(null,e),Jo:rm.bind(null,e)}),e.fu.push((async t=>{t?(e.gu.No(),await Yp(e)):(await e.gu.stop(),e.au.length>0&&(Gu("RemoteStore",`Stopping write stream with ${e.au.length} pending writes`),e.au=[]))}))),e.gu}class lm{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new nl,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,i,r){const s=Date.now()+n,o=new lm(e,t,s,i,r);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tl(el.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hm(e,t){if(Wu("AsyncQueue",`${t}: ${e}`),Rl(e))return new tl(el.UNAVAILABLE,`${t}: ${e}`);throw e}class dm{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Il.comparator(t.key,n.key):(e,t)=>Il.comparator(e.key,t.key),this.keyedMap=Vd(),this.sortedSet=new Ml(this.comparator)}static emptySet(e){return new dm(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof dm))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new dm;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class fm{constructor(){this.yu=new Ml(Il.comparator)}track(e){const t=e.doc.key,n=this.yu.get(t);n?0!==e.type&&3===n.type?this.yu=this.yu.insert(t,e):3===e.type&&1!==n.type?this.yu=this.yu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.yu=this.yu.remove(t):1===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):Yu():this.yu=this.yu.insert(t,e)}pu(){const e=[];return this.yu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class pm{constructor(e,t,n,i,r,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,i){const r=[];return t.forEach((e=>{r.push({type:0,doc:e})})),new pm(e,t,dm.emptySet(t),r,n,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Kh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class mm{constructor(){this.Iu=void 0,this.listeners=[]}}class gm{constructor(){this.queries=new Md((e=>Gh(e)),Kh),this.onlineState="Unknown",this.Tu=new Set}}async function ym(e,t){const n=Zu(e),i=t.query;let r=!1,s=n.queries.get(i);if(s||(r=!0,s=new mm),r)try{s.Iu=await n.onListen(i)}catch(e){const n=hm(e,`Initialization of query '${Wh(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.listeners.push(t),t.Eu(n.onlineState),s.Iu&&t.Au(s.Iu)&&bm(n)}async function vm(e,t){const n=Zu(e),i=t.query;let r=!1;const s=n.queries.get(i);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),r=0===s.listeners.length)}if(r)return n.queries.delete(i),n.onUnlisten(i)}function wm(e,t){const n=Zu(e);let i=!1;for(const e of t){const t=e.query,r=n.queries.get(t);if(r){for(const t of r.listeners)t.Au(e)&&(i=!0);r.Iu=e}}i&&bm(n)}function Im(e,t,n){const i=Zu(e),r=i.queries.get(t);if(r)for(const e of r.listeners)e.onError(n);i.queries.delete(t)}function bm(e){e.Tu.forEach((e=>{e.next()}))}class _m{constructor(e,t,n){this.query=e,this.Ru=t,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=n||{}}Au(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new pm(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),t=!0):this.Vu(e,this.onlineState)&&(this.Su(e),t=!0),this.Pu=e,t}onError(e){this.Ru.error(e)}Eu(e){this.onlineState=e;let t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}Vu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return!(this.options.Du&&n||e.docs.isEmpty()&&"Offline"!==t)}vu(e){if(e.docChanges.length>0)return!0;const t=this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Su(e){e=pm.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}class Tm{constructor(e){this.key=e}}class Em{constructor(e){this.key=e}}class km{constructor(e,t){this.query=e,this.Fu=t,this.$u=null,this.current=!1,this.Bu=Kd(),this.mutatedKeys=Kd(),this.Lu=Yh(e),this.Uu=new dm(this.Lu)}get qu(){return this.Fu}Ku(e,t){const n=t?t.Gu:new fm,i=t?t.Uu:this.Uu;let r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((e,t)=>{const u=i.get(e),l=Qh(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Qu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Lu(l,a)>0||c&&this.Lu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{Uu:s,Gu:n,Oi:o,mutatedKeys:r}}Qu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const i=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;const r=e.Gu.pu();r.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Yu()}};return n(e)-n(t)}(e.type,t.type)||this.Lu(e.doc,t.doc))),this.ju(n);const s=t?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,a=o!==this.$u;return this.$u=o,0!==r.length||a?{snapshot:new pm(this.query,e.Uu,i,r,e.mutatedKeys,0===o,a,!1),zu:s}:{zu:s}}Eu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new fm,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}ju(e){e&&(e.addedDocuments.forEach((e=>this.Fu=this.Fu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Fu=this.Fu.delete(e))),this.current=e.current)}Wu(){if(!this.current)return[];const e=this.Bu;this.Bu=Kd(),this.Uu.forEach((e=>{this.Hu(e.key)&&(this.Bu=this.Bu.add(e.key))}));const t=[];return e.forEach((e=>{this.Bu.has(e)||t.push(new Em(e))})),this.Bu.forEach((n=>{e.has(n)||t.push(new Tm(n))})),t}Ju(e){this.Fu=e.ji,this.Bu=Kd();const t=this.Ku(e.documents);return this.applyChanges(t,!0)}Yu(){return pm.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class Sm{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Am{constructor(e){this.key=e,this.Xu=!1}}class Cm{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Zu={},this.tc=new Md((e=>Gh(e)),Kh),this.ec=new Map,this.nc=new Set,this.sc=new Ml(Il.comparator),this.ic=new Map,this.rc=new Zf,this.oc={},this.uc=new Map,this.cc=Gf.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}async function Nm(e,t){const n=Gm(e);let i,r;const s=n.tc.get(t);if(s)i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),r=s.view.Yu();else{const e=await gp(n.localStore,Hh(t));n.isPrimaryClient&&Fp(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);i=e.targetId,r=await Rm(n,t,i,"current"===s)}return r}async function Rm(e,t,n,i){e.hc=(t,n,i)=>async function(e,t,n,i){let r=t.view.Ku(n);r.Oi&&(r=await vp(e.localStore,t.query,!1).then((({documents:e})=>t.view.Ku(e,r))));const s=i&&i.targetChanges.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,s);return Bm(e,t.targetId,o.zu),o.snapshot}(e,t,n,i);const r=await vp(e.localStore,t,!0),s=new km(t,r.ji),o=s.Ku(r.documents),a=Xd.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);Bm(e,n,c.zu);const u=new Sm(t,n,s);return e.tc.set(t,u),e.ec.has(n)?e.ec.get(n).push(t):e.ec.set(n,[t]),c.snapshot}async function Dm(e,t){const n=Zu(e),i=n.tc.get(t),r=n.ec.get(i.targetId);if(r.length>1)return n.ec.set(i.targetId,r.filter((e=>!Kh(e,t)))),void n.tc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await yp(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),Vp(n.remoteStore,i.targetId),Vm(n,i.targetId)})).catch(Cl)):(Vm(n,i.targetId),await yp(n.localStore,i.targetId,!0))}async function Om(e,t){const n=Zu(e);try{const e=await function(e,t){const n=Zu(e),i=t.snapshotVersion;let r=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Ui.newChangeBuffer({trackRemovals:!0});r=n.$i;const o=[];t.targetChanges.forEach(((s,a)=>{const c=r.get(a);if(!c)return;o.push(n.Vs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Vs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(Bl.EMPTY_BYTE_STRING,ml.min()).withLastLimboFreeSnapshotVersion(ml.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,i)),r=r.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Vs.updateTargetData(e,u))}));let a=Ud(),c=Kd();if(t.documentUpdates.forEach((i=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))})),o.push(pp(e,s,t.documentUpdates).next((e=>{a=e.Gi,c=e.Qi}))),!i.isEqual(ml.min())){const t=n.Vs.getLastRemoteSnapshotVersion(e).next((t=>n.Vs.setTargetsMetadata(e,e.currentSequenceNumber,i)));o.push(t)}return Nl.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.$i=r,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const i=n.ic.get(t);i&&(Ju(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.Xu=!0:e.modifiedDocuments.size>0?Ju(i.Xu):e.removedDocuments.size>0&&(Ju(i.Xu),i.Xu=!1))})),await Hm(n,e,t)}catch(e){await Cl(e)}}function Pm(e,t,n){const i=Zu(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.tc.forEach(((n,i)=>{const r=i.view.Eu(t);r.snapshot&&e.push(r.snapshot)})),function(e,t){const n=Zu(e);n.onlineState=t;let i=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Eu(t)&&(i=!0)})),i&&bm(n)}(i.eventManager,t),e.length&&i.Zu.Go(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Lm(e,t,n){const i=Zu(e);i.sharedClientState.updateQueryState(t,"rejected",n);const r=i.ic.get(t),s=r&&r.key;if(s){let e=new Ml(Il.comparator);e=e.insert(s,yh.newNoDocument(s,ml.min()));const n=Kd().add(s),r=new Qd(ml.min(),new Map,new Fl(dl),e,n);await Om(i,r),i.sc=i.sc.remove(s),i.ic.delete(t),zm(i)}else await yp(i.localStore,t,!1).then((()=>Vm(i,t,n))).catch(Cl)}async function Mm(e,t){const n=Zu(e),i=t.batch.batchId;try{const e=await function(e,t){const n=Zu(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const i=t.batch.keys(),r=n.Ui.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const r=n.batch,s=r.keys();let o=Nl.resolve();return s.forEach((e=>{o=o.next((()=>i.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Ju(null!==s),t.version.compareTo(s)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,r)))}(n,e,t,r).next((()=>r.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Kd();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(n.localStore,t);Fm(n,i,null),Um(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Hm(n,e)}catch(e){await Cl(e)}}async function xm(e,t,n){const i=Zu(e);try{const e=await function(e,t){const n=Zu(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Ju(null!==t),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(i.localStore,t);Fm(i,t,n),Um(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await Hm(i,e)}catch(n){await Cl(n)}}function Um(e,t){(e.uc.get(t)||[]).forEach((e=>{e.resolve()})),e.uc.delete(t)}function Fm(e,t,n){const i=Zu(e);let r=i.oc[i.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),i.oc[i.currentUser.toKey()]=r}}function Vm(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.ec.get(t))e.tc.delete(i),n&&e.Zu.lc(i,n);e.ec.delete(t),e.isPrimaryClient&&e.rc.us(t).forEach((t=>{e.rc.containsKey(t)||jm(e,t)}))}function jm(e,t){e.nc.delete(t.path.canonicalString());const n=e.sc.get(t);null!==n&&(Vp(e.remoteStore,n),e.sc=e.sc.remove(t),e.ic.delete(n),zm(e))}function Bm(e,t,n){for(const i of n)i instanceof Tm?(e.rc.addReference(i.key,t),qm(e,i)):i instanceof Em?(Gu("SyncEngine","Document no longer in limbo: "+i.key),e.rc.removeReference(i.key,t),e.rc.containsKey(i.key)||jm(e,i.key)):Yu()}function qm(e,t){const n=t.key,i=n.path.canonicalString();e.sc.get(n)||e.nc.has(i)||(Gu("SyncEngine","New document in limbo: "+n),e.nc.add(i),zm(e))}function zm(e){for(;e.nc.size>0&&e.sc.size<e.maxConcurrentLimboResolutions;){const t=e.nc.values().next().value;e.nc.delete(t);const n=new Il(yl.fromString(t)),i=e.cc.next();e.ic.set(i,new Am(n)),e.sc=e.sc.insert(n,i),Fp(e.remoteStore,new jf(Hh(Vh(n.path)),i,2,Dl.ot))}}async function Hm(e,t,n){const i=Zu(e),r=[],s=[],o=[];i.tc.isEmpty()||(i.tc.forEach(((e,a)=>{o.push(i.hc(a,t,n).then((e=>{if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),r.push(e);const t=cp.Vi(a.targetId,e);s.push(t)}})))})),await Promise.all(o),i.Zu.Go(r),await async function(e,t){const n=Zu(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Nl.forEach(t,(t=>Nl.forEach(t.Pi,(i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i))).next((()=>Nl.forEach(t.vi,(i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))))))}catch(e){if(!Rl(e))throw e;Gu("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.$i.get(t),i=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(i);n.$i=n.$i.insert(t,r)}}}(i.localStore,s))}async function $m(e,t){const n=Zu(e);if(!n.currentUser.isEqual(t)){Gu("SyncEngine","User change. New user:",t.toKey());const e=await dp(n.localStore,t);n.currentUser=t,function(e,t){e.uc.forEach((e=>{e.forEach((e=>{e.reject(new tl(el.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.uc.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Hm(n,e.Ki)}}function Km(e,t){const n=Zu(e),i=n.ic.get(t);if(i&&i.Xu)return Kd().add(i.key);{let e=Kd();const i=n.ec.get(t);if(!i)return e;for(const t of i){const i=n.tc.get(t);e=e.unionWith(i.view.qu)}return e}}function Gm(e){const t=Zu(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Om.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Km.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Lm.bind(null,t),t.Zu.Go=wm.bind(null,t.eventManager),t.Zu.lc=Im.bind(null,t.eventManager),t}function Wm(e){const t=Zu(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Mm.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=xm.bind(null,t),t}class Qm{constructor(){this.synchronizeTabs=!1}async initialize(e){this.wt=Cp(e.databaseInfo.databaseId),this.sharedClientState=this.dc(e),this.persistence=this._c(e),await this.persistence.start(),this.localStore=this.wc(e),this.gcScheduler=this.mc(e,this.localStore),this.indexBackfillerScheduler=this.gc(e,this.localStore)}mc(e,t){return null}gc(e,t){return null}wc(e){return hp(this.persistence,new up,e.initialUser,this.wt)}_c(e){return new sp(ap.Ms,this.wt)}dc(e){return new bp}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Xm{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Pm(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=$m.bind(null,this.syncEngine),await am(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new gm}createDatastore(e){const t=Cp(e.databaseInfo.databaseId),n=(i=e.databaseInfo,new Sp(i));var i;return function(e,t,n,i){return new Pp(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,r=e=>Pm(this.syncEngine,e,0),s=Tp.V()?new Tp:new _p,new Mp(t,n,i,r,s);var t,n,i,r,s}createSyncEngine(e,t){return function(e,t,n,i,r,s,o){const a=new Cm(e,t,n,i,r,s);return o&&(a.ac=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Zu(e);Gu("RemoteStore","RemoteStore shutting down."),t.lu.add(5),await Up(t),t.du.shutdown(),t._u.set("Unknown")}(this.remoteStore)}}class Ym{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ic(this.observer.next,e)}error(e){this.observer.error?this.Ic(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Tc(){this.muted=!0}Ic(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Jm{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=zu.UNAUTHENTICATED,this.clientId=hl.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Gu("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Gu("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new tl(el.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new nl;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=hm(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Zm(e,t){e.asyncQueue.verifyOperationInProgress(),Gu("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener((async e=>{i.isEqual(e)||(await dp(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function eg(e,t){e.asyncQueue.verifyOperationInProgress();const n=await tg(e);Gu("FirestoreClient","Initializing OnlineComponentProvider");const i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener((e=>om(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>om(t.remoteStore,n))),e.onlineComponents=t}async function tg(e){return e.offlineComponents||(Gu("FirestoreClient","Using default OfflineComponentProvider"),await Zm(e,new Qm)),e.offlineComponents}async function ng(e){return e.onlineComponents||(Gu("FirestoreClient","Using default OnlineComponentProvider"),await eg(e,new Xm)),e.onlineComponents}function ig(e){return ng(e).then((e=>e.syncEngine))}async function rg(e){const t=await ng(e),n=t.eventManager;return n.onListen=Nm.bind(null,t.syncEngine),n.onUnlisten=Dm.bind(null,t.syncEngine),n}const sg=new Map;function og(e,t,n){if(!n)throw new tl(el.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ag(e){if(!Il.isDocumentKey(e))throw new tl(el.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function cg(e){if(Il.isDocumentKey(e))throw new tl(el.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ug(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Yu()}function lg(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tl(el.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ug(e);throw new tl(el.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class hg{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new tl(el.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tl(el.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,i){if(!0===t&&!0===i)throw new tl(el.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class dg{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hg({}),this._settingsFrozen=!1,e instanceof Xl?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tl(el.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xl(e.options.projectId)}(e))}get app(){if(!this._app)throw new tl(el.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tl(el.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hg(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new rl;switch(e.type){case"gapi":const t=e.client;return Ju(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new al(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new tl(el.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=sg.get(e);t&&(Gu("ComponentProvider","Removing Datastore"),sg.delete(e),t.terminate())}(this),Promise.resolve()}}class fg{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fg(this.firestore,e,this._key)}}class pg{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new pg(this.firestore,e,this._query)}}class mg extends pg{constructor(e,t,n){super(e,t,Vh(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new fg(this.firestore,null,new Il(e))}withConverter(e){return new mg(this.firestore,e,this._path)}}function gg(e,t,...n){if(e=A(e),og("collection","path",t),e instanceof dg){const i=yl.fromString(t,...n);return cg(i),new mg(e,null,i)}{if(!(e instanceof fg||e instanceof mg))throw new tl(el.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(yl.fromString(t,...n));return cg(i),new mg(e.firestore,null,i)}}function yg(e,t,...n){if(e=A(e),1===arguments.length&&(t=hl.I()),og("doc","path",t),e instanceof dg){const i=yl.fromString(t,...n);return ag(i),new fg(e,null,new Il(i))}{if(!(e instanceof fg||e instanceof mg))throw new tl(el.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(yl.fromString(t,...n));return ag(i),new fg(e.firestore,e instanceof mg?e.converter:null,new Il(i))}}class vg{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new Np(this,"async_queue_retry"),this.Kc=()=>{const e=Ap();e&&Gu("AsyncQueue","Visibility state changed to "+e.visibilityState),this.So.Eo()};const e=Ap();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Gc(),this.Qc(e)}enterRestrictedMode(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;const t=Ap();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Kc)}}enqueue(e){if(this.Gc(),this.Fc)return new Promise((()=>{}));const t=new nl;return this.Qc((()=>this.Fc&&this.Uc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Mc.push(e),this.jc())))}async jc(){if(0!==this.Mc.length){try{await this.Mc[0](),this.Mc.shift(),this.So.reset()}catch(e){if(!Rl(e))throw e;Gu("AsyncQueue","Operation failed with retryable error: "+e)}this.Mc.length>0&&this.So.Io((()=>this.jc()))}}Qc(e){const t=this.Oc.then((()=>(this.Lc=!0,e().catch((e=>{this.Bc=e,this.Lc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Wu("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Lc=!1,e))))));return this.Oc=t,t}enqueueAfterDelay(e,t,n){this.Gc(),this.qc.indexOf(e)>-1&&(t=0);const i=lm.createAndSchedule(this,e,t,n,(e=>this.Wc(e)));return this.$c.push(i),i}Gc(){this.Bc&&Yu()}verifyOperationInProgress(){}async zc(){let e;do{e=this.Oc,await e}while(e!==this.Oc)}Hc(e){for(const t of this.$c)if(t.timerId===e)return!0;return!1}Jc(e){return this.zc().then((()=>{this.$c.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.$c)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.zc()}))}Yc(e){this.qc.push(e)}Wc(e){const t=this.$c.indexOf(e);this.$c.splice(t,1)}}function wg(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class Ig extends dg{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new vg,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||_g(this),this._firestoreClient.terminate()}}function bg(e){return e._firestoreClient||_g(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function _g(e){var t;const n=e._freezeSettings(),i=function(e,t,n,i){return new Ql(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Jm(e._authCredentials,e._appCheckCredentials,e._queue,i)}class Tg{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tl(el.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wl(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Eg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Eg(Bl.fromBase64String(e))}catch(e){throw new tl(el.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Eg(Bl.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class kg{constructor(e){this._methodName=e}}class Sg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tl(el.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tl(el.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return dl(this._lat,e._lat)||dl(this._long,e._long)}}const Ag=/^__.*__$/;class Cg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ed(e,this.data,this.fieldMask,t,this.fieldTransforms):new Td(e,this.data,t,this.fieldTransforms)}}function Ng(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Yu()}}class Rg{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.wt=n,this.ignoreUndefinedProperties=i,void 0===r&&this.Xc(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(e){return new Rg(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ta({path:n,na:!1});return i.sa(e),i}ia(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ta({path:n,na:!1});return i.Xc(),i}ra(e){return this.ta({path:void 0,na:!0})}oa(e){return Bg(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.sa(this.path.get(e))}sa(e){if(0===e.length)throw this.oa("Document fields must not be empty");if(Ng(this.Zc)&&Ag.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}class Dg{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.wt=n||Cp(e)}aa(e,t,n,i=!1){return new Rg({Zc:e,methodName:t,ca:n,path:wl.emptyPath(),na:!1,ua:i},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function Og(e){const t=e._freezeSettings(),n=Cp(e._databaseId);return new Dg(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Pg(e,t,n,i,r,s={}){const o=e.aa(s.merge||s.mergeFields?2:0,t,n,r);Ug("Data must be an object, but it was:",o,i);const a=Mg(i,o);let c,u;if(s.merge)c=new jl(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const i of s.mergeFields){const r=Fg(t,i,n);if(!o.contains(r))throw new tl(el.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);qg(e,r)||e.push(r)}c=new jl(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Cg(new mh(a),c,u)}function Lg(e,t){if(xg(e=A(e)))return Ug("Unsupported field value:",t,e),Mg(e,t);if(e instanceof kg)return function(e,t){if(!Ng(t.Zc))throw t.oa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.oa(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.na&&4!==t.Zc)throw t.oa("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const r of e){let e=Lg(r,t.ra(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=A(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return td(t.wt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=pl.fromDate(e);return{timestampValue:cf(t.wt,n)}}if(e instanceof pl){const n=new pl(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:cf(t.wt,n)}}if(e instanceof Sg)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Eg)return{bytesValue:uf(t.wt,e._byteString)};if(e instanceof fg){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.oa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:df(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.oa(`Unsupported field value: ${ug(e)}`)}(e,t)}function Mg(e,t){const n={};return Ll(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Pl(e,((e,i)=>{const r=Lg(i,t.ea(e));null!=r&&(n[e]=r)})),{mapValue:{fields:n}}}function xg(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof pl||e instanceof Sg||e instanceof Eg||e instanceof fg||e instanceof kg)}function Ug(e,t,n){if(!xg(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=ug(n);throw"an object"===i?t.oa(e+" a custom object"):t.oa(e+" "+i)}}function Fg(e,t,n){if((t=A(t))instanceof Tg)return t._internalPath;if("string"==typeof t)return jg(e,t);throw Bg("Field path arguments must be of type string or ",e,!1,void 0,n)}const Vg=new RegExp("[~\\*/\\[\\]]");function jg(e,t,n){if(t.search(Vg)>=0)throw Bg(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Tg(...t.split("."))._internalPath}catch(i){throw Bg(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Bg(e,t,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new tl(el.INVALID_ARGUMENT,a+e+c)}function qg(e,t){return e.some((e=>e.isEqual(t)))}class zg{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new fg(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Hg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($g("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Hg extends zg{data(){return super.data()}}function $g(e,t){return"string"==typeof t?jg(e,t):t instanceof Tg?t._internalPath:t._delegate._internalPath}class Kg{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gg extends zg{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Wg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field($g("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Wg extends Gg{data(e={}){return super.data(e)}}class Qg{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Kg(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Wg(this._firestore,this._userDataWriter,n.key,n,new Kg(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tl(el.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>({type:"added",doc:new Wg(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Kg(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++})))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const i=new Wg(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Kg(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Xg(t.type),doc:i,oldIndex:r,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Xg(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Yu()}}function Yg(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tl(el.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jg{convertValue(e,t="none"){switch(th(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Hl(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($l(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Yu()}}convertObject(e,t){const n={};return Pl(e.fields,((e,i)=>{n[e]=this.convertValue(i,t)})),n}convertGeoPoint(e){return new Sg(Hl(e.latitude),Hl(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Gl(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Wl(e));default:return null}}convertTimestamp(e){const t=zl(e);return new pl(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=yl.fromString(e);Ju(Pf(n));const i=new Xl(n.get(1),n.get(3)),r=new Il(n.popFirst(5));return i.isEqual(t)||Wu(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function Zg(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class ey extends Jg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Eg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fg(this.firestore,null,t)}}function ty(e,t,n){e=lg(e,fg);const i=lg(e.firestore,Ig),r=Zg(e.converter,t,n);return ny(i,[Pg(Og(i),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,md.none())])}function ny(e,t){return function(e,t){const n=new nl;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const i=Wm(e);try{const e=await function(e,t){const n=Zu(e),i=pl.now(),r=t.reduce(((e,t)=>e.add(t.key)),Kd());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Ud(),c=Kd();return n.Ui.getEntries(e,r).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((r=>{s=r;const o=[];for(const e of t){const t=bd(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Ed(e.key,t,gh(t.value.mapValue),md.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,o,t)})).next((t=>{o=t;const i=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:jd(s)})))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.oc[e.currentUser.toKey()];i||(i=new Ml(dl)),i=i.insert(t,n),e.oc[e.currentUser.toKey()]=i}(i,e.batchId,n),await Hm(i,e.changes),await Yp(i.remoteStore)}catch(e){const t=hm(e,"Failed to persist write");n.reject(t)}}(await ig(e),t,n))),n.promise}(bg(e),t)}function iy(e,t,n){const i=n.docs.get(t._key),r=new ey(e);return new Gg(e,r,t._key,i,new Kg(n.hasPendingWrites,n.fromCache),t.converter)}!function(e,t=!0){!function(e){Hu=e}(ye),he(new C("firestore",((e,{options:n})=>{const i=e.getProvider("app").getImmediate(),r=new Ig(i,new sl(e.getProvider("auth-internal")),new ul(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),r._setSettings(n),r}),"PUBLIC")),_e(qu,"3.4.11",e),_e(qu,"3.4.11","esm2017")}(),console.log("-----------");const ry=function(e=we()){return de(e,"firestore").getImmediate()}(Ve.initializeApp({apiKey:"AIzaSyBI3zUaFz8l7Y68aAgVNb8UEHUt3RSAjng",authDomain:"library-cfd08.firebaseapp.com",projectId:"library-cfd08",storageBucket:"library-cfd08.appspot.com",messagingSenderId:"837470737044",appId:"1:837470737044:web:a18f941b234776bda19a81",measurementId:"G-4Z3YHPNSGX"})),sy=function(e=we()){const t=de(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=de(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(w(n.getOptions(),null!=t?t:{}))return e;rt(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:xr,persistence:[Oi,mi,yi]})}();class oy{constructor(e,t,n){this.title=e,this.author=t,this.read=n}get Title(){return this.title}get Author(){return this.author}get Read(){return this.read}set Title(e){this.title=e}set Author(e){this.author=e}set Read(e){this.read=e}static bookConverter={toFirestore:e=>({title:e.title,author:e.author,read:e.read}),fromFirestore:(e,t)=>{const n=e.data(t);return new oy(n.title,n.author,n.read)}}}const ay=document.getElementById("login_buttom"),cy=document.getElementById("logout_buttom"),uy=document.getElementById("username"),ly=document.getElementById("username-text"),hy=document.querySelector(".main_body"),dy=e=>e.style.display="none",fy=e=>e.style.display="block",py=e=>ly.innerHTML=e;function my(e){const t=[];return e.forEach((e=>{const n=e.data();n.doc=e.ref.withConverter(oy.bookConverter),t.push(function(e){const t=document.createElement("div");t.classList.add("book_card"),t.onclick=()=>vy(e);const n=document.createElement("div");n.classList.add("book_shadow");const i=document.createElement("div");i.classList.add("book_marker",1==e.read?"bm-read":"bm-reading");const r=document.createElement("div");r.classList.add("book_main");const s=document.createElement("p");s.classList.add("book_title"),s.append(e.title);const o=document.createElement("p");return o.classList.add("book_author"),o.append(e.author),r.append(s,o),t.append(n,i,r),t}(n))})),t}function gy(e){e.push(function(){const e=document.createElement("div");e.classList.add("add_card"),e.onclick=wy;const t=document.createElement("div");t.classList.add("shadow_btn");const n=document.createElement("div");n.classList.add("add_btn");const i=document.createElement("div"),r=document.createElement("div");return n.append(i,r),e.append(t,n),e}()),hy.replaceChildren(...e)}function yy(e){e?(dy(ay),fy(cy),py(e.displayName),fy(uy)):(dy(cy),fy(ay),dy(uy),py("Uknow"),dy(uy))}const vy=e=>{Ey(),Uy(e)},wy=()=>{Ey(),Uy()},Iy=document.querySelector(".overlay"),by=document.querySelector(".overlay .overlay"),_y=document.querySelector(".popup-delete"),Ty=document.querySelector(".popup-edit");function Ey(){fy(Iy),fy(Ty)}function ky(){dy(Iy),dy(Ty),Oy=null}function Sy(){dy(by),dy(_y)}const Ay=document.querySelector(".popup-edit .close"),Cy=document.querySelector(".popup-delete .close");Ay.addEventListener("click",ky),Cy.addEventListener("click",Sy);const Ny=document.querySelector(".popup-edit .title"),Ry=document.querySelector(".popup-edit .author"),Dy=document.querySelector(".popup-edit .bottom .del_btn");Dy.addEventListener("click",(function(){fy(by),fy(_y)}));let Oy=null;document.querySelector(".popup-edit .btn").addEventListener("click",(e=>{jy(new oy(Ny.value,Ry.value,Ly.checked),Oy?Oy.doc:null),ky()}));document.querySelector(".popup-delete .btn").addEventListener("click",(e=>{(function(e){return ny(lg(e.firestore,Ig),[new Cd(e._key,md.none())])})(Oy.doc).then((e=>{console.log("Book deleted: ",e)})).catch((e=>{console.log("Error on delete book: ",e)})),Sy(),ky()}));const Py=document.querySelectorAll(".lcb"),Ly=document.querySelector("#read"),My=document.querySelector("#reading");Py.forEach((e=>e.addEventListener("click",(e=>xy(e.target)))));function xy(e){Ly.checked=!1,My.checked=!1,e.checked=!0}function Uy(e){Oy=e,e?(Ny.value=e.title,Ry.value=e.author,xy(1==e.read?Ly:My),fy(Dy)):(Ny.value="The book's title...",Ry.value="Te book's author...",xy(Ly),dy(Dy))}const Fy=gg(ry,"Users");function Vy(){return gg(yg(Fy,sy.currentUser.uid),"Books")}function jy(e,t){console.log(e),t?ty(t,e).then((e=>{console.log("Book edited: ",e)})).catch((e=>{console.log("Error on edit book: ",e)})):ty(yg(Vy()).withConverter(oy.bookConverter),e).then((e=>{console.log("Book added: ",e)})).catch((e=>{console.log("Error on add book: ",e)}))}let By=null;function qy(){By&&(By(),By=null);const e=function(e,...t){for(const n of t)e=n._apply(e);return e}(Vy());By=function(e,...t){var n,i,r;e=A(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||wg(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(wg(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(i=e.error)||void 0===i?void 0:i.bind(e),t[o+2]=null===(r=e.complete)||void 0===r?void 0:r.bind(e)}let c,u,l;if(e instanceof fg)u=lg(e.firestore,Ig),l=Vh(e._key.path),c={next:n=>{t[o]&&t[o](iy(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=lg(e,pg);u=lg(n.firestore,Ig),l=n._query;const i=new ey(u);c={next:e=>{t[o]&&t[o](new Qg(u,i,n,e))},error:t[o+1],complete:t[o+2]},Yg(e._query)}return function(e,t,n,i){const r=new Ym(i),s=new _m(t,r,n);return e.asyncQueue.enqueueAndForget((async()=>ym(await rg(e),s))),()=>{r.Tc(),e.asyncQueue.enqueueAndForget((async()=>vm(await rg(e),s)))}}(bg(u),l,a,c)}(e,(e=>{gy(my(e))}))}new oy("Fundamentos da Matemática Elementar: Volume 1","Gelson Iezzi",!1),new oy("Livro do Dessasosego","Fernando Pessoa",!0),new oy("Um bom livro pra popular","Author Zika P. Karai",!1);const zy=[];for(let e=1;e<=10;e++)zy.push(new oy("Livro Volume "+e,"Author "+e,e%2!=0));const Hy=new Tn;!function(e,t,n,i){A(e).onAuthStateChanged(t,n,i)}(sy,(e=>{yy(e),qy()})),ay.addEventListener("click",(()=>{tr(sy,Hy).then((e=>{console.log("logIn: "+e)})).catch((e=>{const t=e.code,n=e.message;console.log(t,n)}))})),cy.addEventListener("click",(()=>{!function(e){A(e).signOut()}(sy)}))})();